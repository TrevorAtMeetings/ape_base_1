{% extends "base.html" %}

{% block content %}
<div class="container" style="margin-top: 30px;">
    <div class="row">
        <div class="col s12">
            <!-- Header Section -->
            <div class="card-panel teal white-text z-depth-2" style="margin-bottom: 30px;">
                <h1 style="margin-bottom: 10px; font-size: 2.2rem; font-weight: 500;">
                    <i class="material-icons left" style="font-size: 2.2rem; margin-right: 15px;">check_circle</i>
                    Pump Selection Results
                </h1>
                <p style="margin: 0; font-size: 1.15rem; font-weight: 300;">
                    Found {{ pump_selections|length }} suitable pump{{ 's' if pump_selections|length != 1 else '' }} 
                    for your requirements: <strong>{{ "%.1f"|format(site_requirements['flow_m3hr']) }} mÂ³/hr</strong> 
                    at <strong>{{ "%.1f"|format(site_requirements['head_m']) }} m</strong> head
                </p>
            </div>

            <!-- Pump Selection List -->
            <div class="card z-depth-1">
                <div class="card-content grey lighten-5" style="padding: 20px;">
                    <h5 style="margin: 0; color: #1976d2; font-weight: 500;">
                        <i class="material-icons left" style="color: #1976d2;">list</i>
                        Recommended Pumps (Ranked by Suitability Score)
                    </h5>
                </div>
                <div class="card-content" style="padding: 0;">
                    <div class="collection">
                        {% for pump in pump_selections %}
                            <a href="{{ url_for('reports.pump_report', 
                                              pump_code=pump['pump_code'], 
                                              flow=site_requirements['flow_m3hr'], 
                                              head=site_requirements['head_m'], 
                                              pump_type=site_requirements['pump_type']) }}" 
                               class="collection-item" style="padding: 25px; transition: background-color 0.2s ease; border-left: 4px solid #1976d2;">
                                
                                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px;">
                                    <div>
                                        <h5 style="margin: 0 0 8px 0; color: #1976d2; font-weight: 500;">
                                            <i class="material-icons left" style="color: #1976d2;">settings</i>
                                            {{ pump['pump_code'] }}
                                        </h5>
                                        <p style="color: #757575; margin: 0; font-size: 0.95rem;">{{ pump['pump']['manufacturer'] }} - {{ pump['pump']['pump_type'] }}</p>
                                    </div>
                                    <div>
                                        <span class="chip green white-text" style="font-size: 0.9rem; font-weight: 500; padding: 8px 16px;">
                                            Score: {{ "%.1f"|format(pump['suitability_score']) }}
                                        </span>
                                    </div>
                                </div>
                                
                                <!-- Performance Summary -->
                                <div class="row" style="text-align: center;">
                                    <div class="col s6 m3">
                                        <div class="card-panel white z-depth-1" style="padding: 15px; margin: 0 5px;">
                                            <i class="material-icons" style="color: #1976d2; font-size: 1.8rem; display: block; margin-bottom: 8px;">trending_up</i>
                                            <div style="font-weight: 500; font-size: 1.2rem; color: #212121;">{{ "%.1f"|format(pump['performance'].get('efficiency_pct', 0)) }}%</div>
                                            <small style="color: #757575; font-size: 0.8rem;">Efficiency</small>
                                        </div>
                                    </div>
                                    <div class="col s6 m3">
                                        <div class="card-panel white z-depth-1" style="padding: 15px; margin: 0 5px;">
                                            <i class="material-icons" style="color: #ff9800; font-size: 1.8rem; display: block; margin-bottom: 8px;">flash_on</i>
                                            <div style="font-weight: 500; font-size: 1.2rem; color: #212121;">{{ "%.1f"|format(pump['performance'].get('power_kw', 0)) }} kW</div>
                                            <small style="color: #757575; font-size: 0.8rem;">Power</small>
                                        </div>
                                    </div>
                                    <div class="col s6 m3">
                                        <div class="card-panel white z-depth-1" style="padding: 15px; margin: 0 5px;">
                                            <i class="material-icons" style="color: #2196f3; font-size: 1.8rem; display: block; margin-bottom: 8px;">opacity</i>
                                            <div style="font-weight: 500; font-size: 1.2rem; color: #212121;">{{ "%.1f"|format(pump['performance'].get('npshr_m', 0)) }} m</div>
                                            <small style="color: #757575; font-size: 0.8rem;">NPSH</small>
                                        </div>
                                    </div>
                                    <div class="col s6 m3">
                                        <div class="card-panel white z-depth-1" style="padding: 15px; margin: 0 5px;">
                                            <i class="material-icons" style="color: #607d8b; font-size: 1.8rem; display: block; margin-bottom: 8px;">rotate_right</i>
                                            <div style="font-weight: 500; font-size: 1.2rem; color: #212121;">
                                                {% if pump['sizing_info'] and pump['sizing_info'].get('impeller_trim_pct') %}
                                                    {{ pump['sizing_info']['impeller_trim_pct']|round|int }}%
                                                {% elif pump['performance'].get('sizing_info') and pump['performance']['sizing_info'].get('impeller_trim_pct') %}
                                                    {{ pump['performance']['sizing_info']['impeller_trim_pct']|round|int }}%
                                                {% else %}
                                                    --
                                                {% endif %}
                                            </div>
                                            <small style="color: #757575; font-size: 0.8rem;">Impeller Trim</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Action Hint -->
                                <div style="margin-top: 20px; text-align: center;">
                                    <small style="color: #1976d2; font-size: 0.9rem;">
                                        <i class="material-icons" style="font-size: 16px; vertical-align: middle; margin-right: 4px;">visibility</i>
                                        Click to view detailed performance analysis & PDF report
                                    </small>
                                </div>
                            </a>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div style="margin-top: 30px; text-align: center;">
                <a href="{{ url_for('main_flow.index') }}" class="btn waves-effect waves-light grey darken-1">
                    <i class="material-icons left">arrow_back</i>
                    Start New Selection
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}