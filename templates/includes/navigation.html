<!-- Executive-Grade Navigation Component -->
<style>
/* Executive Navigation Styles */
:root {
    --nav-primary: #1565C0;
    --nav-primary-hover: #1976D2;
    --nav-surface: #FFFFFF;
    --nav-on-surface: #37474F;
    --nav-border: #E0E0E0;
    --nav-shadow: 0 4px 20px rgba(21, 101, 192, 0.1);
    --nav-dropdown-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
    --nav-transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.unified-nav {
    background: var(--nav-surface);
    box-shadow: var(--nav-shadow);
    border-bottom: 1px solid var(--nav-border);
    position: sticky;
    top: 0;
    z-index: 1000;
    font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
}

.nav-container {
    max-width: 1440px;
    margin: 0 auto;
    padding: 0 24px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    min-height: 64px;
}

.nav-brand {
    font-size: 20px;
    font-weight: 700;
    color: var(--nav-primary);
    text-decoration: none;
    transition: var(--nav-transition);
}

.nav-brand:hover {
    color: var(--nav-primary-hover);
    transform: translateX(2px);
}

.nav-actions {
    display: flex;
    align-items: center;
    gap: 8px;
}

.nav-dropdown {
    position: relative;
}

.nav-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px 20px;
    border: none;
    background: transparent;
    color: var(--nav-on-surface);
    font-size: 15px;
    font-weight: 500;
    cursor: pointer;
    border-radius: 12px;
    transition: var(--nav-transition);
    text-decoration: none;
    position: relative;
    overflow: hidden;
}

.nav-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(21, 101, 192, 0.1), transparent);
    transition: left 0.5s;
}

.nav-btn:hover::before {
    left: 100%;
}

.nav-btn:hover {
    background: rgba(21, 101, 192, 0.08);
    color: var(--nav-primary);
    transform: translateY(-1px);
}

.nav-btn.primary {
    background: linear-gradient(135deg, var(--nav-primary) 0%, var(--nav-primary-hover) 100%);
    color: white;
    font-weight: 600;
    box-shadow: 0 2px 8px rgba(21, 101, 192, 0.3);
}

.nav-btn.primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 16px rgba(21, 101, 192, 0.4);
}

.nav-dropdown-content {
    position: absolute;
    top: calc(100% + 8px);
    left: 0;
    min-width: 200px;
    background: white;
    border-radius: 12px;
    box-shadow: var(--nav-dropdown-shadow);
    border: 1px solid var(--nav-border);
    opacity: 0;
    visibility: hidden;
    transform: translateY(-8px);
    transition: var(--nav-transition);
    z-index: 1001;
    overflow: hidden;
    max-height: 400px;
    padding: 8px 0;
}

.nav-dropdown-content.show {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

.nav-dropdown-content a {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 16px;
    color: var(--nav-on-surface);
    text-decoration: none;
    font-size: 14px;
    font-weight: 500;
    transition: var(--nav-transition);
    position: relative;
    margin: 0 4px;
    border-radius: 8px;
}

.nav-dropdown-content a:hover {
    background: linear-gradient(90deg, rgba(21, 101, 192, 0.1), rgba(21, 101, 192, 0.15));
    color: var(--nav-primary);
    transform: translateX(2px);
}

.nav-dropdown-content a .material-icons-round {
    font-size: 18px;
    opacity: 0.7;
}

.nav-dropdown-content a:hover .material-icons-round {
    opacity: 1;
}

/* Responsive Design */
@media (max-width: 768px) {
    .nav-container {
        padding: 0 16px;
        flex-wrap: wrap;
        gap: 8px;
    }
    
    .nav-actions {
        flex-wrap: wrap;
        gap: 4px;
    }
    
    .nav-btn {
        padding: 10px 16px;
        font-size: 14px;
    }
    
    .nav-dropdown-content {
        min-width: 180px;
        right: 0;
        left: auto;
    }
    
    .nav-dropdown-content a {
        padding: 6px 12px;
        font-size: 13px;
        gap: 8px;
    }
}
</style>

<script>
// Modern Navigation Dropdown System with Best Practices
(function() {
    'use strict';
    
    function initializeNavDropdowns() {
        console.log('Initializing navigation dropdowns...');
        const dropdownButtons = document.querySelectorAll('.nav-dropdown > button');
        console.log('Found', dropdownButtons.length, 'dropdown buttons');
        
        dropdownButtons.forEach(button => {
            // Add ARIA attributes for accessibility
            button.setAttribute('aria-haspopup', 'true');
            button.setAttribute('aria-expanded', 'false');
            
            // Click handler
            button.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                const dropdownContent = this.parentElement.querySelector('.nav-dropdown-content');
                if (!dropdownContent) return;
                
                const isOpen = dropdownContent.classList.contains('show');
                
                // Close all dropdowns first
                closeAllDropdowns();
                
                // Toggle this dropdown
                if (!isOpen) {
                    dropdownContent.classList.add('show');
                    this.setAttribute('aria-expanded', 'true');
                    
                    // Focus first menu item for keyboard navigation
                    const firstMenuItem = dropdownContent.querySelector('a');
                    if (firstMenuItem) {
                        setTimeout(() => firstMenuItem.focus(), 100);
                    }
                }
            });
            
            // Keyboard navigation
            button.addEventListener('keydown', function(e) {
                if (e.key === 'ArrowDown' || e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    this.click();
                }
            });
        });
        
        // Enhanced keyboard navigation for dropdown items
        document.querySelectorAll('.nav-dropdown-content').forEach(dropdown => {
            const items = dropdown.querySelectorAll('a');
            
            items.forEach((item, index) => {
                item.addEventListener('keydown', function(e) {
                    switch(e.key) {
                        case 'ArrowDown':
                            e.preventDefault();
                            const nextItem = items[index + 1] || items[0];
                            nextItem.focus();
                            break;
                        case 'ArrowUp':
                            e.preventDefault();
                            const prevItem = items[index - 1] || items[items.length - 1];
                            prevItem.focus();
                            break;
                        case 'Escape':
                            e.preventDefault();
                            closeAllDropdowns();
                            dropdown.parentElement.querySelector('button').focus();
                            break;
                    }
                });
            });
        });
        
        // Close dropdowns when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.nav-dropdown')) {
                closeAllDropdowns();
            }
        });
        
        // Close dropdowns on Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeAllDropdowns();
            }
        });
    }
    
    function closeAllDropdowns() {
        document.querySelectorAll('.nav-dropdown-content').forEach(dropdown => {
            dropdown.classList.remove('show');
        });
        document.querySelectorAll('.nav-dropdown > button').forEach(button => {
            button.setAttribute('aria-expanded', 'false');
        });
    }
    
    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeNavDropdowns);
    } else {
        initializeNavDropdowns();
    }
})();
</script>

<!-- Navigation Bar -->
<nav class="unified-nav">
    <div class="nav-container">
        <a href="{{ url_for('main_flow.index') }}" class="nav-brand">
            <span>APE Pumps Selection</span>
        </a>
        
        <div class="nav-actions">
            <!-- Tools Dropdown -->
            <div class="nav-dropdown">
                <button class="nav-btn">
                    <span>Tools ▾</span>
                </button>
                <div class="nav-dropdown-content">
                    <a href="{{ url_for('comparison.pump_comparison') }}">Pump Comparison</a>
                    <a href="{{ url_for('comparison.shortlist_comparison') }}">Shortlist Compare</a>
                    <a href="{{ url_for('pump_editor.pump_editor') }}">Pump Editor</a>
                    <a href="{{ url_for('ai_extract.ai_extract_page') }}">AI Data Extract</a>
                    <a href="{{ url_for('data_management.data_management') }}">Database Manager</a>
                </div>
            </div>
            
            <!-- Admin Dropdown -->
            <div class="nav-dropdown">
                <button class="nav-btn">
                    <span>Admin ▾</span>
                </button>
                <div class="nav-dropdown-content">
                    <a href="{{ url_for('admin_config.index') }}">Configuration</a>
                    <a href="{{ url_for('admin.ai_admin') }}">AI Admin</a>
                    <a href="/admin/brain">Brain System</a>
                    <a href="{{ url_for('admin.testing_interface') }}">Performance Testing</a>
                    <a href="{{ url_for('admin.admin_landing') }}">Documents</a>
                </div>
            </div>
            
            <!-- Help Dropdown -->
            <div class="nav-dropdown">
                <button class="nav-btn">
                    <span>Help ▾</span>
                </button>
                <div class="nav-dropdown-content">
                    <a href="{{ url_for('main_flow.guide') }}">User Guide</a>
                    <a href="https://apepumps.projectapp.ai/" target="_blank">Features</a>
                    <a href="{{ url_for('main_flow.about') }}">About</a>
                </div>
            </div>
            
            {% if show_view_toggle %}
            <div class="view-toggle">
                {% if current_view == 'presentation' %}
                <span class="nav-btn active">
                    <span>Presentation</span>
                </span>
                <a href="{{ engineering_url }}" class="nav-btn">
                    <span>Engineering</span>
                </a>
                {% else %}
                <a href="{{ presentation_url }}" class="nav-btn">
                    <span>Presentation</span>
                </a>
                <span class="nav-btn active">
                    <span>Engineering</span>
                </span>
                {% endif %}
            </div>
            {% endif %}
            
            {% if show_edit %}
            <button class="nav-btn" onclick="toggleEditMode()">
                <span>Edit</span>
            </button>
            {% endif %}
            
            {% if show_print %}
            <button class="nav-btn" onclick="window.print()">
                <span>⎙</span>
                <span>Print</span>
            </button>
            {% endif %}
            
            {% if show_new_search %}
            <a href="/" class="nav-btn primary">
                <span>New Search</span>
            </a>
            {% endif %}
        </div>
    </div>
</nav>

<!-- Breadcrumb Bar -->
{% if breadcrumbs %}
<div class="breadcrumb-bar">
    <div class="container">
        <ul class="breadcrumb-list">
            {% for crumb in breadcrumbs %}
            <li class="breadcrumb-item">
                {% if not loop.last %}
                    <a href="{{ crumb.url }}" class="breadcrumb-link">
                        {{ crumb.label }}
                    </a>
                    <span class="breadcrumb-separator"></span>
                {% else %}
                    <span class="breadcrumb-current">{{ crumb.label }}</span>
                {% endif %}
            </li>
            {% endfor %}
        </ul>
    </div>
</div>
{% endif %}

<!-- Spacer to prevent content overlap -->
<div class="nav-spacer"></div>