<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APE Pumps Selection Report</title>
    <style>
        @page {
            size: A4;
            margin: 20mm;
            @top-left {
                content: "APE Pumps Selection Report";
                font-family: Arial, sans-serif;
                font-size: 10pt;
                color: #004d40;
            }
            @top-right {
                content: "Page " counter(page) " of " counter(pages);
                font-family: Arial, sans-serif;
                font-size: 10pt;
                color: #666;
            }
            @bottom-center {
                content: "APE Pumps Ltd. - Engineering Excellence in Fluid Handling";
                font-family: Arial, sans-serif;
                font-size: 9pt;
                color: #666;
                border-top: 1px solid #ccc;
                padding-top: 5pt;
            }
        }

        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.4;
            color: #333;
            margin: 0;
            padding: 0;
        }

        .cover-page {
            page-break-after: always;
            background: linear-gradient(135deg, #004d40 0%, #00695c 100%);
            color: white;
            padding: 40pt;
            text-align: center;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .logo-section {
            margin-bottom: 40pt;
        }

        .ape-logo {
            width: 200pt;
            height: auto;
            margin-bottom: 20pt;
        }

        .tagline {
            font-size: 14pt;
            font-style: italic;
            color: #b2dfdb;
            margin-bottom: 60pt;
        }

        .header {
            background: linear-gradient(135deg, #004d40 0%, #00695c 100%);
            color: white;
            padding: 20pt;
            margin-bottom: 20pt;
            border-radius: 5pt;
        }

        .header h1 {
            margin: 0 0 10pt 0;
            font-size: 24pt;
            font-weight: bold;
        }

        .header .subtitle {
            font-size: 14pt;
            opacity: 0.9;
            margin: 0;
        }

        .logo {
            float: right;
            height: 60pt;
            width: auto;
        }

        .section {
            margin-bottom: 20pt;
            page-break-inside: avoid;
        }

        .section-title {
            background-color: #e0f2f1;
            color: #004d40;
            padding: 10pt;
            font-size: 16pt;
            font-weight: bold;
            margin-bottom: 10pt;
            border-left: 4pt solid #004d40;
        }

        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15pt;
            margin-bottom: 15pt;
        }

        .info-card {
            border: 1pt solid #ddd;
            border-radius: 5pt;
            padding: 15pt;
            background-color: #fafafa;
        }

        .info-card h3 {
            margin: 0 0 10pt 0;
            color: #004d40;
            font-size: 14pt;
        }

        .spec-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10pt 0;
        }

        .spec-table th,
        .spec-table td {
            border: 1pt solid #ddd;
            padding: 8pt;
            text-align: left;
        }

        .spec-table th {
            background-color: #004d40;
            color: white;
            font-weight: bold;
        }

        .spec-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .pump-selection {
            background-color: #e8f5e8;
            border: 2pt solid #4caf50;
            border-radius: 8pt;
            padding: 15pt;
            margin: 15pt 0;
        }

        .pump-selection h3 {
            color: #2e7d32;
            margin: 0 0 10pt 0;
            font-size: 18pt;
        }

        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10pt;
            margin: 10pt 0;
        }

        .metric {
            text-align: center;
            padding: 8pt;
            background-color: white;
            border-radius: 5pt;
            border: 1pt solid #ddd;
        }

        .metric-value {
            font-size: 18pt;
            font-weight: bold;
            color: #004d40;
        }

        .metric-label {
            font-size: 10pt;
            color: #666;
            margin-top: 5pt;
        }

        .chart-container {
            text-align: center;
            margin: 20pt 0;
            page-break-inside: avoid;
        }

        .chart-container img {
            max-width: 100%;
            height: auto;
            border: 1pt solid #ddd;
            border-radius: 5pt;
        }

        .reasoning-list {
            list-style: none;
            padding: 0;
        }

        .reasoning-list li {
            background-color: #f5f5f5;
            margin: 5pt 0;
            padding: 10pt;
            border-left: 3pt solid #004d40;
            border-radius: 0 5pt 5pt 0;
        }

        .alternative-pumps {
            background-color: #fff3e0;
            border: 1pt solid #ff9800;
            border-radius: 5pt;
            padding: 15pt;
            margin: 10pt 0;
        }

        .alternative-pumps h4 {
            color: #e65100;
            margin: 0 0 10pt 0;
        }

        .recommendations {
            background-color: #e3f2fd;
            border: 1pt solid #2196f3;
            border-radius: 5pt;
            padding: 15pt;
            margin: 15pt 0;
        }

        .recommendations h3 {
            color: #1565c0;
            margin: 0 0 10pt 0;
        }

        .page-break {
            page-break-before: always;
        }

        .signature-section {
            margin-top: 30pt;
            padding-top: 20pt;
            border-top: 1pt solid #ddd;
        }

        .signature-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30pt;
            margin-top: 20pt;
        }

        .signature-block {
            text-align: center;
        }

        .signature-line {
            border-bottom: 1pt solid #333;
            height: 30pt;
            margin-bottom: 5pt;
        }

        .watermark {
            position: fixed;
            bottom: 10mm;
            right: 10mm;
            opacity: 0.1;
            font-size: 8pt;
            color: #004d40;
            transform: rotate(-45deg);
        }
    </style>
</head>
<body>
    <div class="watermark">APE PUMPS CONFIDENTIAL</div>

    <!-- Cover Page -->
    <div class="cover-page">
        <div class="logo-section">
            {% if ape_logo_base64 %}
            <img src="data:image/svg+xml;base64,{{ ape_logo_base64 }}" alt="APE Pumps" class="ape-logo"/>
            {% else %}
            <div class="ape-logo" style="text-align: center; color: #004d40; font-weight: bold; font-size: 24pt;">APE PUMPS</div>
            {% endif %}
            <div class="tagline">Leaders in pump innovation</div>
        </div>
        
        <h1 style="font-size: 36pt; margin: 20pt 0;">Pump Selection Report</h1>
        <h2 style="font-size: 18pt; font-weight: normal; margin: 10pt 0;">{{ report_data.customer_info.project_name }}</h2>
        <h3 style="font-size: 14pt; font-weight: normal; margin: 30pt 0;">Prepared for: {{ report_data.customer_info.customer_name }}</h3>
        <div style="font-size: 12pt; margin-top: 40pt;">
            <p>Date: {{ report_data.customer_info.report_date }}</p>
            <p>Prepared By: AI Pump Selection Assistant</p>
        </div>
    </div>

    <!-- Header Section for subsequent pages -->
    <div class="header">
        <h1>1. Selected Pump Summary</h1>
        <p class="subtitle">Manufacturer: APE Pumps</p>
        <div style="clear: both;"></div>
    </div>

    <!-- Selected Pump Summary -->
    <div class="section">
        <div class="pump-selection">
            <h3>Pump Model: {{ report_data.selected_pump.pump_code }}</h3>
            <table class="spec-table">
                <tr><td><strong>Pump Type:</strong></td><td>{{ report_data.selected_pump.pump_type }}</td></tr>
                <tr><td><strong>Pump Range:</strong></td><td>{{ report_data.selected_pump.series }}</td></tr>
                <tr><td><strong>Selected Configuration:</strong></td><td>{{ report_data.selected_pump.impeller_info }}</td></tr>
                <tr><td><strong>Application:</strong></td><td>{{ report_data.site_requirements.application_type }}</td></tr>
            </table>
        </div>
    </div>

    <!-- Duty Point Requirements -->
    <div class="section page-break">
        <div class="section-title">2. Duty Point Requirements</div>
        <table class="spec-table">
            <tr><td><strong>Required Flow (Q_req):</strong></td><td>{{ report_data.site_requirements.flow_m3hr }} m³/hr</td></tr>
            <tr><td><strong>Required Head (H_req):</strong></td><td>{{ report_data.site_requirements.head_m }} m</td></tr>
            <tr><td><strong>Fluid:</strong></td><td>{{ report_data.site_requirements.liquid_type }}</td></tr>
        </table>
    </div>

    <!-- Performance Analysis & Alignment with Requirements -->
    <div class="section">
        <div class="section-title">3. Performance Analysis & Alignment with Requirements</div>
        <p>The {{ report_data.selected_pump.pump_code }}, configured with {{ report_data.selected_pump.impeller_info }}, has been selected as highly suitable for the specified duty point.</p>
        
        <h4>Meeting the Duty Point:</h4>
        <p>At a flow rate of {{ report_data.site_requirements.flow_m3hr }} m³/hr, this pump configuration will deliver a head of approximately {{ "%.1f"|format(report_data.selected_pump.operating_point.get('achieved_head_m', 0)) }} m. This directly meets the specified head and flow requirements.</p>
        <p><strong>Reasoning:</strong> {{ report_data.selected_pump.selection_reason }}</p>

        <h4>Operational Efficiency:</h4>
        <p>The pump will operate at an efficiency of approximately {{ "%.1f"|format(report_data.selected_pump.operating_point.get('achieved_efficiency_pct', 0)) }}% at this duty point.</p>
        <p><strong>Reasoning & Insight:</strong> {{ report_data.technical_analysis.bep_explanation|default("This operating point provides excellent efficiency for the application, ensuring optimal energy consumption and reduced operational costs.") }}</p>

        <h4>Power Consumption:</h4>
        <p>The anticipated absorbed power at the duty point is approximately {{ "%.1f"|format(report_data.selected_pump.operating_point.get('achieved_power_kw', 0)) }} kW.</p>
        <p><strong>Reasoning & Insight:</strong> {{ report_data.technical_analysis.power_explanation|default("This power consumption is optimized for the given flow and head requirements, providing efficient operation with manageable energy costs.") }}</p>

        <h4>Net Positive Suction Head Required (NPSHr):</h4>
        <p>The NPSHr for the pump at {{ report_data.site_requirements.flow_m3hr }} m³/hr is approximately {{ "%.1f"|format(report_data.selected_pump.operating_point.get('achieved_npshr_m', 0)) if report_data.selected_pump.operating_point.get('achieved_npshr_m') is not none else 'N/A' }} meters.</p>
        <p><strong>Reasoning & Insight:</strong> {{ report_data.technical_analysis.npsh_explanation|default("This NPSH requirement must be considered in system design to prevent cavitation. Ensuring adequate NPSH available is critical for optimal pump operation and longevity.") }}</p>

        <h4>Pump Type Alignment:</h4>
        <p>The {{ report_data.selected_pump.pump_type }} design is well-suited for "{{ report_data.site_requirements.application_type }}" applications.</p>
        <p><strong>Reasoning & Insight:</strong> This pump type provides reliable performance and is specifically designed for the intended application requirements.</p>
    </div>

    <!-- Selected Pump Details -->
    <div class="section">
        <div class="section-title">Selected Pump Specifications</div>
        <table class="spec-table">
            <thead>
                <tr>
                    <th>Parameter</th>
                    <th>Value</th>
                    <th>Units</th>
                    <th>Notes</th>
                </tr>
            </thead>
            <tbody>
                {% for spec in report_data.pump_specifications %}
                <tr>
                    <td><strong>{{ spec.parameter }}</strong></td>
                    <td>{{ spec.value }}</td>
                    <td>{{ spec.units }}</td>
                    <td>{{ spec.notes }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Performance Analysis -->
    <div class="section page-break">
        <div class="section-title">Performance Analysis</div>
        
        <div class="chart-container">
            <h4>Pump Performance Curves</h4>
            {% if report_data.charts and report_data.charts.performance_curve %}
            <img src="data:image/png;base64,{{ report_data.charts.performance_curve }}" alt="Pump Performance Curves">
            {% else %}
            <div class="chart-placeholder">Performance chart unavailable</div>
            {% endif %}
            <p><em>Operating point shown in red, highlighting optimal efficiency range</em></p>
        </div>

        <div class="info-grid">
            <div class="info-card">
                <h3>Operating Point Analysis</h3>
                <ul class="reasoning-list">
                    {% for point in report_data.performance_analysis.operating_points %}
                    <li>{{ point }}</li>
                    {% endfor %}
                </ul>
            </div>
            <div class="info-card">
                <h3>Efficiency Benefits</h3>
                <ul class="reasoning-list">
                    {% for benefit in report_data.performance_analysis.efficiency_benefits %}
                    <li>{{ benefit }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>

    <!-- Technical Reasoning -->
    <div class="section">
        <div class="section-title">Technical Selection Reasoning</div>
        {% for reason in report_data.technical_reasoning %}
        <div class="info-card">
            <h3>{{ reason.title }}</h3>
            <p>{{ reason.explanation }}</p>
        </div>
        {% endfor %}
    </div>

    <!-- Alternative Options -->
    {% if report_data.alternatives %}
    <div class="section">
        <div class="section-title">Alternative Pump Options</div>
        {% for alt in report_data.alternatives %}
        <div class="alternative-pumps">
            <h4>{{ alt.pump_code }} - {{ alt.selection_reason }}</h4>
            <p><strong>Key Difference:</strong> {{ alt.key_difference }}</p>
            <p><strong>Performance:</strong> {{ alt.performance_summary }}</p>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Recommendations -->
    <div class="section">
        <div class="section-title">Recommendations & Next Steps</div>
        <div class="recommendations">
            <h3>Implementation Recommendations</h3>
            <ul>
                {% for recommendation in report_data.recommendations %}
                <li>{{ recommendation }}</li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <!-- Key Insights & Recommendations -->
    <div class="section page-break">
        <div class="section-title">4. Key Insights & Recommendations</div>
        
        <h4>Optimal Selection for Efficiency:</h4>
        <p>The selection of the {{ report_data.selected_pump.pump_code }} for the duty of {{ report_data.site_requirements.flow_m3hr }} m³/hr at {{ report_data.site_requirements.head_m }}m head represents an optimal choice from an energy efficiency perspective, operating at {{ "%.1f"|format(report_data.selected_pump.operating_point.get('achieved_efficiency_pct', 0)) }}% efficiency.</p>
        
        <h4>System NPSH Verification:</h4>
        <p>Critical attention must be paid to the system's NPSHa to ensure it is greater than the pump's {{ "%.1f"|format(report_data.selected_pump.operating_point.get('achieved_npshr_m', 0)) if report_data.selected_pump.operating_point.get('achieved_npshr_m') is not none else 'N/A' }}m NPSHr to guarantee cavitation-free operation.</p>
        
        <h4>Motor Sizing:</h4>
        <p>A motor should be selected based on the {{ "%.1f"|format(report_data.selected_pump.operating_point.get('achieved_power_kw', 0)) }} kW power consumption, incorporating an appropriate service factor as per standard engineering practice.</p>
        
        <h4>Robust Design for Application:</h4>
        <p>The pump's specifications ({{ report_data.selected_pump.pump_type }}) align well with standard requirements for robust {{ report_data.site_requirements.application_type|lower }} applications.</p>
    </div>

    <!-- Performance Chart Section -->
    {% if report_data.charts and report_data.charts.performance_curve %}
    <div class="section page-break">
        <div class="section-title">Performance Characteristic Curves</div>
        <div class="chart-container">
            <img src="data:image/png;base64,{{ report_data.charts.performance_curve }}" 
                 alt="Pump Performance Curves" 
                 style="max-width: 100%; height: auto;">
        </div>
        <p style="text-align: center; font-size: 10pt; color: #666; margin-top: 10pt;">
            Performance curves showing operating point, efficiency, power, and NPSH characteristics
        </p>
    </div>
    {% endif %}

    <!-- Disclaimer Section -->
    <div class="section">
        <div class="section-title">5. Disclaimer</div>
        <p>This report is based on the performance data presented in the APE Pumps characteristic curve sheets for the {{ report_data.selected_pump.pump_code }} model. Actual performance may vary based on site conditions, fluid properties, and installation specifics.</p>
        <p>It is recommended that final pump selection be verified against actual site conditions and that professional installation and commissioning be undertaken to ensure optimal performance.</p>
    </div>

    <!-- Signature Section -->
    <div class="signature-section">
        <div class="section-title">Approval & Authorization</div>
        <p>This report has been prepared by qualified APE Pumps engineers and represents our professional recommendation based on the provided requirements.</p>
        
        <div class="signature-grid">
            <div class="signature-block">
                <div class="signature-line"></div>
                <p><strong>Prepared By</strong><br>
                APE Pumps Engineering Team<br>
                Date: {{ report_data.customer_info.report_date }}</p>
            </div>
            <div class="signature-block">
                <div class="signature-line"></div>
                <p><strong>Customer Approval</strong><br>
                {{ report_data.customer_info.customer_name }}<br>
                Date: _______________</p>
            </div>
        </div>
    </div>

    <!-- Footer Information -->
    <div class="section">
        <div style="text-align: center; font-size: 10pt; color: #666; margin-top: 20pt;">
            <p><strong>APE Pumps Ltd.</strong><br>
            Engineering Excellence in Fluid Handling Solutions<br>
            www.apepumps.com | info@apepumps.com</p>
        </div>
    </div>
</body>
</html>