{% extends "admin/base.html" %}

{% block admin_title %}Brain System Administration{% endblock %}

{% block admin_content %}
<div class="container" style="margin-top: 20px;">
    <!-- Page Header -->
    <div class="row">
        <div class="col s12">
            <div class="card-panel">
                <h4 class="blue-text text-darken-2">
                    <i class="material-icons left">psychology</i>
                    Brain System Administration
                </h4>
                <p>System Status: <span class="badge green white-text">System operating normally</span></p>
                <p class="grey-text">Production Configuration: {{ stats.production_config|default('production_default') }}</p>
            </div>
        </div>
    </div>

    <!-- System Status Overview -->
    <div class="row">
        <div class="col s12 m4">
            <div class="card">
                <div class="card-content">
                    <span class="card-title">Data Quality Issues</span>
                    <h3 class="blue-text">{{ stats.total_quality_issues|default(0) }}</h3>
                    <p class="grey-text">Critical: {{ stats.critical_issues|default(0) }}</p>
                    <p class="grey-text">Major: {{ stats.major_issues|default(0) }}</p>
                </div>
            </div>
        </div>
        <div class="col s12 m4">
            <div class="card">
                <div class="card-content">
                    <span class="card-title">Critical Issues</span>
                    <h3 class="red-text">{{ stats.critical_issues|default(0) }}</h3>
                    <p class="grey-text">Require immediate attention</p>
                </div>
            </div>
        </div>
        <div class="col s12 m4">
            <div class="card">
                <div class="card-content">
                    <span class="card-title">Active Corrections</span>
                    <h3 class="green-text">{{ stats.active_corrections|default(0) }}</h3>
                    <p class="grey-text">Corrections in overlay system</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Data Quality Management Section -->
    <div class="row">
        <div class="col s12">
            <div class="card">
                <div class="card-content">
                    <span class="card-title">
                        <i class="material-icons left">assessment</i>
                        Data Quality Management
                    </span>
                    <p>Monitor and manage data quality issues across all pump specifications and performance curves. Identify inconsistencies, outliers, and missing data that could affect selection accuracy.</p>
                </div>
                <div class="card-action">
                    <a href="{{ url_for('brain_admin.data_quality_dashboard') }}" class="btn">
                        View Quality Issues
                    </a>
                    <a href="#" class="btn-flat blue-text disabled">
                        Run Quality Scan
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Data Corrections System Section -->
    <div class="row">
        <div class="col s12">
            <div class="card">
                <div class="card-content">
                    <span class="card-title">
                        <i class="material-icons left">edit</i>
                        Data Corrections System
                    </span>
                    <p>Manage the overlay correction system. Propose, review, and approve corrections to pump data without modifying the golden source database. All changes are auditable and reversible.</p>
                </div>
                <div class="card-action">
                    <a href="{{ url_for('brain_admin.corrections_dashboard') }}" class="btn">
                        Manage Corrections
                    </a>
                    <a href="{{ url_for('brain_admin.corrections_dashboard') }}" class="btn-flat blue-text">
                        Propose Correction
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Tunable Physics Engine Section -->
    <div class="row">
        <div class="col s12">
            <div class="card">
                <div class="card-content">
                    <span class="card-title">
                        <i class="material-icons left">tune</i>
                        Tunable Physics Engine
                    </span>
                    <p>Calibrate the Brain's physics model for BEP migration calculations. Compare against manufacturer data, analyze accuracy, and tune calibration factors for optimal performance.</p>
                    <div class="chip orange lighten-4">
                        <span class="orange-text text-darken-2">NEW</span>
                    </div>
                </div>
                <div class="card-action">
                    <a href="{{ url_for('brain_admin.calibration_tool') }}" class="btn orange">
                        <i class="material-icons left">tune</i>
                        Calibration Tool
                    </a>
                    <a href="#" class="btn-flat orange-text" onclick="runQuickCalibration()">
                        Quick Test
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Brain Logic Workbench Section -->
    <div class="row">
        <div class="col s12">
            <div class="card">
                <div class="card-content">
                    <span class="card-title">
                        <i class="material-icons left">science</i>
                        Brain Logic Workbench
                    </span>
                    <p>Test and validate Brain logic changes in a safe environment. Simulate different configurations, test corrections, and analyze the impact before deploying to production.</p>
                </div>
                <div class="card-action">
                    <a href="{{ url_for('brain_admin.brain_workbench') }}" class="btn">
                        Open Workbench
                    </a>
                    <a href="#" class="btn-flat blue-text">
                        Test Scenario
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Configuration Management Section -->
    <div class="row">
        <div class="col s12 m6">
            <div class="card">
                <div class="card-content">
                    <span class="card-title">
                        <i class="material-icons left">settings</i>
                        Configuration Management
                    </span>
                    <p>Manage Brain configuration profiles for different use cases. Create, test, and deploy configurations with different scoring weights and logic parameters.</p>
                </div>
                <div class="card-action">
                    <a href="/admin/config/" class="btn blue">
                        Configuration Manager
                    </a>
                    <a href="/admin/config/profile/new" class="btn-flat blue-text">
                        New Profile
                    </a>
                </div>
            </div>
        </div>

        <!-- Manufacturer Comparison Section -->
        <div class="col s12 m6">
            <div class="card">
                <div class="card-content">
                    <span class="card-title">
                        <i class="material-icons left">compare_arrows</i>
                        Manufacturer Comparison
                    </span>
                    <p>Compare Brain selections against manufacturer recommendations. Upload datasheets, analyze differences, and identify opportunities for improvement.</p>
                </div>
                <div class="card-action">
                    <a href="{{ url_for('brain_admin.brain_workbench') }}" class="btn blue">
                        Comparison Tool
                    </a>
                    <a href="#" onclick="showPumpSelector()" class="btn-flat blue-text">
                        Calibrate Pump
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Decision Analytics Section -->
    <div class="row">
        <div class="col s12">
            <div class="card">
                <div class="card-content">
                    <span class="card-title">
                        <i class="material-icons left">analytics</i>
                        Decision Analytics
                    </span>
                    <p>Analyze Brain decision patterns, track accuracy improvements over time, and generate reports on system performance and feasibility.</p>
                </div>
                <div class="card-action">
                    <a href="#" class="btn disabled">
                        View Analytics
                    </a>
                    <a href="#" class="btn-flat blue-text disabled">
                        Generate Report
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock admin_content %}

{% block scripts %}
{{ super() }}
<script>
function runQuickCalibration() {
    alert('Quick calibration test will be implemented soon');
}

function showPumpSelector() {
    // Create a modal for pump selection
    const modalHtml = `
        <div id="pump-selector-modal" class="modal">
            <div class="modal-content">
                <h4>Select Pump for Calibration</h4>
                <p>Enter the pump code to open its calibration workbench:</p>
                <div class="input-field">
                    <input type="text" id="pump-code-input" placeholder="e.g., 4503-44648">
                    <label for="pump-code-input">Pump Code</label>
                </div>
                <div class="row">
                    <div class="col s12">
                        <p class="grey-text">Or select from recent pumps:</p>
                        <div class="collection">
                            <a href="/admin/pump-calibration/4503-44648" class="collection-item">4503-44648 - 6x8x10 WL</a>
                            <a href="/admin/pump-calibration/4502-42848" class="collection-item">4502-42848 - 6x8x10 WLN</a>
                            <a href="/admin/pump-calibration/2502-55" class="collection-item">2502-55 - 10 WLN 32A</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <a href="#!" class="modal-close waves-effect waves-red btn-flat">Cancel</a>
                <a href="#!" onclick="navigateToCalibration()" class="waves-effect waves-green btn-flat">Open Calibration</a>
            </div>
        </div>
    `;
    
    // Add modal to page if not exists
    if (!document.getElementById('pump-selector-modal')) {
        document.body.insertAdjacentHTML('beforeend', modalHtml);
    }
    
    // Initialize and open modal
    const modal = document.getElementById('pump-selector-modal');
    const instance = M.Modal.init(modal);
    instance.open();
    
    // Focus on input
    setTimeout(() => {
        document.getElementById('pump-code-input').focus();
    }, 100);
}

function navigateToCalibration() {
    const pumpCode = document.getElementById('pump-code-input').value.trim();
    if (pumpCode) {
        window.location.href = `/admin/pump-calibration/${pumpCode}`;
    } else {
        M.toast({html: 'Please enter a pump code', classes: 'red'});
    }
}
</script>
{% endblock %}