{% extends "admin/base.html" %}

{% block title %}Brain System Administration{% endblock %}

{% block head %}
<style>
/* Brain-specific CSS variables to avoid conflicts with style.css */
:root {
    /* Brain Material Design 3 Color Tokens - Unique namespace */
    --brain-md-primary: #6750A4;
    --brain-md-on-primary: #FFFFFF;
    --brain-md-primary-container: #EADDFF;
    --brain-md-on-primary-container: #21005D;
    --brain-md-secondary: #625B71;
    --brain-md-on-secondary: #FFFFFF;
    --brain-md-secondary-container: #E8DEF8;
    --brain-md-on-secondary-container: #1D192B;
    --brain-md-tertiary: #7D5260;
    --brain-md-on-tertiary: #FFFFFF;
    --brain-md-tertiary-container: #FFD8E4;
    --brain-md-on-tertiary-container: #31111D;
    --brain-md-error: #BA1A1A;
    --brain-md-on-error: #FFFFFF;
    --brain-md-error-container: #FFDAD6;
    --brain-md-on-error-container: #410002;
    --brain-md-background: #FFFBFE;
    --brain-md-on-background: #1C1B1F;
    --brain-md-surface: #FFFBFE;
    --brain-md-on-surface: #1C1B1F;
    --brain-md-surface-variant: #E7E0EC;
    --brain-md-on-surface-variant: #49454F;
    --brain-md-outline: #79747E;
    --brain-md-outline-variant: #CAC4D0;
    
    /* Brain Material Design 3 Elevation */
    --brain-elevation-0: 0px 0px 0px 0px rgba(0, 0, 0, 0.00);
    --brain-elevation-1: 0px 1px 2px 0px rgba(0, 0, 0, 0.30), 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
    --brain-elevation-2: 0px 1px 2px 0px rgba(0, 0, 0, 0.30), 0px 2px 6px 2px rgba(0, 0, 0, 0.15);
    --brain-elevation-3: 0px 1px 3px 0px rgba(0, 0, 0, 0.30), 0px 4px 8px 3px rgba(0, 0, 0, 0.15);
    --brain-elevation-4: 0px 2px 3px 0px rgba(0, 0, 0, 0.30), 0px 6px 10px 4px rgba(0, 0, 0, 0.15);
    --brain-elevation-5: 0px 4px 4px 0px rgba(0, 0, 0, 0.30), 0px 8px 12px 6px rgba(0, 0, 0, 0.15);
    
    /* Material Design 3 Typography Scale */
    --md-sys-typescale-display-large-size: 57px;
    --md-sys-typescale-display-large-weight: 400;
    --md-sys-typescale-headline-large-size: 32px;
    --md-sys-typescale-headline-large-weight: 400;
    --md-sys-typescale-headline-medium-size: 28px;
    --md-sys-typescale-headline-medium-weight: 400;
    --md-sys-typescale-title-large-size: 22px;
    --md-sys-typescale-title-large-weight: 400;
    --md-sys-typescale-title-medium-size: 16px;
    --md-sys-typescale-title-medium-weight: 500;
    --md-sys-typescale-body-large-size: 16px;
    --md-sys-typescale-body-large-weight: 400;
    --md-sys-typescale-body-medium-size: 14px;
    --md-sys-typescale-body-medium-weight: 400;
    --md-sys-typescale-label-large-size: 14px;
    --md-sys-typescale-label-large-weight: 500;
}

/* Brain Dashboard - Aggressive Materialize Override */
body .brain-dashboard,
html .brain-dashboard,
.brain-dashboard.brain-dashboard.brain-dashboard {
    background: var(--brain-md-background) !important;
    min-height: 100vh !important;
    padding: 24px 0 !important;
    font-family: 'Google Sans', 'Roboto', -apple-system, BlinkMacSystemFont, sans-serif !important;
    margin: 0 !important;
    color: var(--brain-md-on-background) !important;
    box-sizing: border-box !important;
}

.brain-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 24px;
}

/* Brain Header - Maximum Specificity Override */
.brain-dashboard .brain-header.brain-header.brain-header,
body .brain-dashboard .brain-header {
    background: var(--brain-md-primary-container) !important;
    border-radius: 28px !important;
    padding: 40px !important;
    margin-bottom: 32px !important;
    color: var(--brain-md-on-primary-container) !important;
    box-shadow: var(--brain-elevation-2) !important;
    position: relative !important;
    overflow: hidden !important;
    border: none !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
}

.brain-header::before {
    content: '';
    position: absolute;
    top: -100px;
    right: -100px;
    width: 300px;
    height: 300px;
    background: var(--md-sys-color-primary);
    opacity: 0.08;
    border-radius: 50%;
}

.header-content {
    position: relative;
    z-index: 2;
}

.brain-title {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 16px;
}

.brain-dashboard .brain-title h1 {
    font-size: var(--md-sys-typescale-headline-large-size) !important;
    font-weight: var(--md-sys-typescale-headline-large-weight) !important;
    margin: 0 !important;
    line-height: 1.2 !important;
    color: var(--brain-md-on-primary-container) !important;
}

.brain-icon {
    font-size: 48px;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
}

.brain-subtitle {
    font-size: var(--md-sys-typescale-body-large-size);
    font-weight: var(--md-sys-typescale-body-large-weight);
    color: var(--md-sys-color-on-primary-container);
    opacity: 0.8;
    margin: 0;
    line-height: 1.5;
}

/* Material Design 3 Status Cards - Override Materialize */
.brain-dashboard .status-overview {
    display: grid !important;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)) !important;
    gap: 24px !important;
    margin-bottom: 40px !important;
}

.brain-dashboard .status-card {
    background: var(--brain-md-surface) !important;
    border-radius: 20px !important;
    padding: 24px !important;
    box-shadow: var(--brain-elevation-1) !important;
    border: 1px solid var(--brain-md-outline-variant) !important;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    position: relative !important;
    overflow: hidden !important;
    margin: 0 !important;
}

.status-card:hover {
    box-shadow: var(--md-sys-elevation-level3);
    transform: translateY(-2px);
}

.status-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--md-sys-color-primary);
    border-radius: 20px 20px 0 0;
}

.status-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 16px;
}

.status-label {
    font-size: var(--md-sys-typescale-label-large-size);
    font-weight: var(--md-sys-typescale-label-large-weight);
    color: var(--md-sys-color-on-surface-variant);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.status-icon {
    font-size: 24px;
    opacity: 0.8;
}

.status-value {
    font-size: 36px;
    font-weight: 700;
    color: var(--md-sys-color-on-surface);
    margin-bottom: 8px;
    line-height: 1;
}

.status-description {
    font-size: var(--md-sys-typescale-body-medium-size);
    font-weight: var(--md-sys-typescale-body-medium-weight);
    color: var(--md-sys-color-on-surface-variant);
    margin: 0;
    line-height: 1.4;
}

.status-critical .status-value { color: var(--md-sys-color-error); }
.status-critical::before { background: var(--md-sys-color-error); }

.status-warning .status-value { color: #F9AB00; }
.status-warning::before { background: #F9AB00; }

.status-success .status-value { color: #137333; }
.status-success::before { background: #137333; }

/* Material Design 3 Feature Cards - Override Materialize */
.brain-dashboard .features-grid {
    display: grid !important;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)) !important;
    gap: 32px !important;
}

.brain-dashboard .feature-card {
    background: var(--brain-md-surface) !important;
    border-radius: 24px !important;
    padding: 32px !important;
    box-shadow: var(--brain-elevation-1) !important;
    border: 1px solid var(--brain-md-outline-variant) !important;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    position: relative !important;
    overflow: hidden !important;
    margin: 0 !important;
}

.feature-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--md-sys-elevation-level4);
}

.feature-card::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--md-sys-color-primary) 0%, var(--md-sys-color-tertiary) 100%);
    border-radius: 24px 24px 0 0;
}

.feature-header {
    display: flex;
    align-items: center;
    gap: 20px;
    margin-bottom: 20px;
}

.feature-icon {
    font-size: 32px;
    background: var(--md-sys-color-secondary-container);
    color: var(--md-sys-color-on-secondary-container);
    padding: 16px;
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 64px;
    min-height: 64px;
}

.feature-title {
    font-size: var(--md-sys-typescale-title-large-size);
    font-weight: var(--md-sys-typescale-title-large-weight);
    color: var(--md-sys-color-on-surface);
    margin: 0;
    line-height: 1.3;
}

.feature-description {
    color: var(--md-sys-color-on-surface-variant);
    font-size: var(--md-sys-typescale-body-medium-size);
    line-height: 1.6;
    margin-bottom: 24px;
}

.feature-actions {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
}

/* Material Design 3 Buttons - Override Materialize */
.brain-dashboard .btn,
.brain-dashboard .btn-primary,
.brain-dashboard .btn-secondary {
    display: inline-flex !important;
    align-items: center !important;
    gap: 8px !important;
    padding: 10px 24px !important;
    border-radius: 20px !important;
    font-size: var(--md-sys-typescale-label-large-size) !important;
    font-weight: var(--md-sys-typescale-label-large-weight) !important;
    text-decoration: none !important;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;
    border: none !important;
    cursor: pointer !important;
    min-height: 40px !important;
    box-sizing: border-box !important;
    position: relative !important;
    overflow: hidden !important;
    text-transform: none !important;
    line-height: normal !important;
    margin: 0 !important;
}

.brain-dashboard .btn-primary {
    background: var(--brain-md-primary) !important;
    color: var(--brain-md-on-primary) !important;
    box-shadow: var(--brain-elevation-1) !important;
}

.brain-dashboard .btn-primary:hover {
    box-shadow: var(--brain-elevation-2) !important;
    transform: translateY(-1px) !important;
    color: var(--brain-md-on-primary) !important;
    filter: brightness(1.05) !important;
}

.brain-dashboard .btn-primary:active {
    transform: translateY(0) !important;
    box-shadow: var(--brain-elevation-1) !important;
}

.brain-dashboard .btn-secondary {
    background: transparent !important;
    color: var(--brain-md-primary) !important;
    border: 1px solid var(--brain-md-outline) !important;
}

.brain-dashboard .btn-secondary:hover {
    background: var(--brain-md-primary) !important;
    color: var(--brain-md-on-primary) !important;
    border-color: var(--brain-md-primary) !important;
    transform: translateY(-1px) !important;
}

.brain-dashboard .btn-secondary:active {
    transform: translateY(0) !important;
}

/* Brain Breadcrumb */
.brain-dashboard .brain-breadcrumb {
    margin-bottom: 24px !important;
    font-size: var(--md-sys-typescale-body-medium-size) !important;
    color: var(--brain-md-on-surface-variant) !important;
    display: flex !important;
    align-items: center !important;
    gap: 8px !important;
}

.brain-dashboard .brain-breadcrumb a {
    color: var(--brain-md-primary) !important;
    text-decoration: none !important;
    transition: color 0.2s ease !important;
}

.brain-dashboard .brain-breadcrumb a:hover {
    color: var(--brain-md-on-surface) !important;
    text-decoration: underline !important;
}

/* Material Design 3 Responsive Design */
@media (max-width: 905px) {
    .brain-container {
        padding: 0 16px;
    }
    
    .brain-header {
        padding: 32px 24px;
        border-radius: 20px;
    }
    
    .brain-title h1 {
        font-size: 28px;
    }
    
    .status-overview {
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 16px;
    }
    
    .features-grid {
        grid-template-columns: 1fr;
        gap: 24px;
    }
    
    .feature-card {
        padding: 24px;
    }
}

/* Scoring Algorithm Section */
.brain-section {
    margin-bottom: 48px;
}

.section-header {
    text-align: center;
    margin-bottom: 40px;
}

.section-title {
    font-size: var(--md-sys-typescale-headline-medium-size) !important;
    font-weight: var(--md-sys-typescale-headline-medium-weight) !important;
    color: var(--brain-md-on-surface) !important;
    margin: 0 0 8px 0 !important;
}

.section-subtitle {
    font-size: var(--md-sys-typescale-body-large-size);
    color: var(--brain-md-on-surface-variant);
    margin: 0;
}

.scoring-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 24px;
    margin-bottom: 40px;
}

.algorithm-card {
    background: var(--brain-md-surface);
    border: 1px solid var(--brain-md-outline-variant);
    border-radius: 16px;
    padding: 24px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
}

.algorithm-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--brain-elevation-3);
}

.algorithm-card .card-icon {
    font-size: 32px;
    margin-bottom: 16px;
    opacity: 0.8;
}

.algorithm-card h4 {
    font-size: var(--md-sys-typescale-title-medium-size) !important;
    font-weight: var(--md-sys-typescale-title-medium-weight) !important;
    color: var(--brain-md-on-surface) !important;
    margin: 0 0 8px 0 !important;
}

.points-badge {
    display: inline-block;
    background: var(--brain-md-primary-container);
    color: var(--brain-md-on-primary-container);
    padding: 4px 12px;
    border-radius: 12px;
    font-size: var(--md-sys-typescale-label-large-size);
    font-weight: var(--md-sys-typescale-label-large-weight);
    margin-bottom: 16px;
}

.algorithm-details .formula {
    background: var(--brain-md-surface-variant);
    padding: 12px;
    border-radius: 8px;
    margin-bottom: 16px;
}

.algorithm-details .formula code {
    font-family: 'JetBrains Mono', 'Consolas', monospace;
    font-size: 13px;
    color: var(--brain-md-on-surface-variant);
}

.algorithm-ranges {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.range-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 12px;
    background: var(--brain-md-background);
    border-radius: 6px;
    border: 1px solid var(--brain-md-outline-variant);
}

.range-label {
    font-size: var(--md-sys-typescale-body-medium-size);
    color: var(--brain-md-on-surface);
}

.range-score {
    font-size: var(--md-sys-typescale-label-large-size);
    font-weight: var(--md-sys-typescale-label-large-weight);
    color: var(--brain-md-primary);
}

.range-score.color-error {
    color: var(--brain-md-error) !important;
}

/* Methodology Flow */
.methodology-flow {
    display: flex;
    flex-direction: column;
    gap: 24px;
}

.method-step {
    display: flex;
    gap: 20px;
    align-items: flex-start;
}

.step-number {
    background: var(--brain-md-primary);
    color: var(--brain-md-on-primary);
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: var(--md-sys-typescale-title-medium-size);
    font-weight: var(--md-sys-typescale-title-medium-weight);
    flex-shrink: 0;
}

.step-content h4 {
    font-size: var(--md-sys-typescale-title-medium-size) !important;
    font-weight: var(--md-sys-typescale-title-medium-weight) !important;
    color: var(--brain-md-on-surface) !important;
    margin: 0 0 8px 0 !important;
}

.step-content p {
    color: var(--brain-md-on-surface-variant);
    margin: 0 0 12px 0;
    line-height: 1.5;
}

.step-criteria {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.criteria-item {
    font-size: var(--md-sys-typescale-body-medium-size);
    color: var(--brain-md-on-surface-variant);
    padding-left: 8px;
}

@media (max-width: 600px) {
    .brain-dashboard {
        padding: 16px 0;
    }
    
    .brain-container {
        padding: 0 16px;
    }
    
    .brain-header {
        padding: 24px 20px;
        border-radius: 16px;
    }
    
    .brain-title {
        flex-direction: column;
        text-align: center;
        gap: 12px;
    }
    
    .brain-title h1 {
        font-size: 24px;
    }
    
    .status-overview {
        grid-template-columns: 1fr;
        gap: 12px;
    }
    
    .status-card {
        padding: 20px;
        border-radius: 16px;
    }
    
    .feature-card {
        padding: 20px;
        border-radius: 20px;
    }
    
    .feature-header {
        gap: 16px;
    }
    
    .feature-icon {
        min-width: 56px;
        min-height: 56px;
        padding: 12px;
    }
    
    .feature-actions {
        flex-direction: column;
    }
    
    .btn {
        justify-content: center;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="admin-dashboard">
    <div class="admin-container">
        <!-- Executive Breadcrumb Navigation -->
        <nav class="admin-breadcrumb">
            <a href="/admin">
                <span class="material-icons-round">admin_panel_settings</span>
                Admin Dashboard
            </a>
            <span class="material-icons-round">chevron_right</span>
            <span style="color: var(--admin-secondary); font-weight: 600;">Brain System Administration</span>
        </nav>

        <!-- Executive Brain Header -->
        <header class="admin-header">
            <h1 class="admin-title">Brain System Administration</h1>
            <p class="admin-subtitle">
                Advanced AI-powered pump intelligence platform with real-time analytics, data quality management, and intelligent decision support for mission-critical engineering operations.
            </p>
        </header>

        <!-- Executive Performance Dashboard -->
        <div style="background: white; border-radius: 20px; padding: 32px; margin-bottom: 32px; box-shadow: 0 8px 32px rgba(21, 101, 192, 0.1); border: 1px solid #E0E0E0;">
            <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 24px; flex-wrap: wrap;">
                <div style="background: linear-gradient(135deg, #6750A4 0%, #7B1FA2 100%); padding: 16px; border-radius: 16px; color: white; flex-shrink: 0;">
                    <span class="material-icons-round" style="font-size: 32px;">psychology</span>
                </div>
                <div style="flex: 1; min-width: 300px;">
                    <h3 style="font-size: 24px; font-weight: 700; color: #1A202C; margin: 0; line-height: 1.2;">Brain Intelligence Status</h3>
                    <p style="color: #4A5568; margin: 8px 0 0 0; font-size: 16px; line-height: 1.4;">Real-time monitoring of AI system performance and data quality metrics</p>
                </div>
                <div style="background: linear-gradient(135deg, #2E7D32 0%, #4CAF50 100%); padding: 12px 20px; border-radius: 12px; color: white; font-weight: 600; font-size: 14px;">
                    <span class="material-icons-round" style="font-size: 18px; margin-right: 6px; vertical-align: middle;">check_circle</span>
                    System Operating Normally
                </div>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 20px;">
                <div style="text-align: center; padding: 24px 16px; background: linear-gradient(135deg, #F7FAFC 0%, #EDF2F7 100%); border-radius: 16px; border: 1px solid #E2E8F0;">
                    <div style="font-size: 28px; font-weight: 900; color: #2E7D32; margin-bottom: 8px;">386</div>
                    <div style="font-size: 13px; color: #4A5568; font-weight: 600; line-height: 1.3;">Active<br>Pump Models</div>
                </div>
                <div style="text-align: center; padding: 24px 16px; background: linear-gradient(135deg, #F7FAFC 0%, #EDF2F7 100%); border-radius: 16px; border: 1px solid #E2E8F0;">
                    <div style="font-size: 28px; font-weight: 900; color: #1565C0; margin-bottom: 8px;">99.8%</div>
                    <div style="font-size: 13px; color: #4A5568; font-weight: 600; line-height: 1.3;">Data<br>Quality</div>
                </div>
                <div style="text-align: center; padding: 24px 16px; background: linear-gradient(135deg, #F7FAFC 0%, #EDF2F7 100%); border-radius: 16px; border: 1px solid #E2E8F0;">
                    <div style="font-size: 28px; font-weight: 900; color: #7B1FA2; margin-bottom: 8px;">6.2K</div>
                    <div style="font-size: 13px; color: #4A5568; font-weight: 600; line-height: 1.3;">Performance<br>Points</div>
                </div>
                <div style="text-align: center; padding: 24px 16px; background: linear-gradient(135deg, #F7FAFC 0%, #EDF2F7 100%); border-radius: 16px; border: 1px solid #E2E8F0;">
                    <div style="font-size: 28px; font-weight: 900; color: #FF6F00; margin-bottom: 8px;">24/7</div>
                    <div style="font-size: 13px; color: #4A5568; font-weight: 600; line-height: 1.3;">AI<br>Monitoring</div>
                </div>
            </div>
        </div>

        <!-- Executive Navigation Tabs -->
        <div style="background: white; border-radius: 16px; padding: 8px; margin-bottom: 32px; box-shadow: 0 4px 16px rgba(21, 101, 192, 0.1); border: 1px solid #E0E0E0;">
            <nav style="display: flex; gap: 8px; overflow-x: auto;">
                <a href="#overview" class="admin-tab admin-tab-active" style="padding: 12px 20px; border-radius: 12px; font-weight: 600; font-size: 14px; text-decoration: none; color: white; background: linear-gradient(135deg, var(--admin-primary) 0%, #1976D2 100%); white-space: nowrap;">
                    <span class="material-icons-round" style="font-size: 18px; margin-right: 6px; vertical-align: middle;">dashboard</span>
                    OVERVIEW
                </a>
                <a href="#data-quality" class="admin-tab" style="padding: 12px 20px; border-radius: 12px; font-weight: 600; font-size: 14px; text-decoration: none; color: #4A5568; background: #F7FAFC; white-space: nowrap; transition: all 0.2s;">
                    <span class="material-icons-round" style="font-size: 18px; margin-right: 6px; vertical-align: middle;">bar_chart</span>
                    DATA QUALITY
                </a>
                <a href="#corrections" class="admin-tab" style="padding: 12px 20px; border-radius: 12px; font-weight: 600; font-size: 14px; text-decoration: none; color: #4A5568; background: #F7FAFC; white-space: nowrap; transition: all 0.2s;">
                    <span class="material-icons-round" style="font-size: 18px; margin-right: 6px; vertical-align: middle;">auto_fix_high</span>
                    CORRECTIONS
                </a>
                <a href="#workbench" class="admin-tab" style="padding: 12px 20px; border-radius: 12px; font-weight: 600; font-size: 14px; text-decoration: none; color: #4A5568; background: #F7FAFC; white-space: nowrap; transition: all 0.2s;">
                    <span class="material-icons-round" style="font-size: 18px; margin-right: 6px; vertical-align: middle;">science</span>
                    WORKBENCH
                </a>
            </nav>
        </div>

        <!-- Executive Status Grid -->
        <div class="admin-grid" style="grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 32px;">
            <div class="admin-card">
                <div class="admin-card-header">
                    <span class="admin-card-icon">
                        {% if stats.critical_issues > 0 %}<span class="material-icons-round" style="color: #DC2626;">error</span>
                        {% elif stats.major_issues > 0 %}<span class="material-icons-round" style="color: #F59E0B;">warning</span>
                        {% else %}<span class="material-icons-round" style="color: #059669;">check_circle</span>{% endif %}
                    </span>
                    <h3 class="admin-card-title">Data Quality Issues</h3>
                </div>
                <div style="text-align: center; padding: 20px 0;">
                    <div style="font-size: 48px; font-weight: 900; color: {% if stats.total_quality_issues > 0 %}#DC2626{% else %}#059669{% endif %}; line-height: 1;">{{ stats.total_quality_issues or 0 }}</div>
                    <p style="color: #6B7280; margin: 8px 0 0 0; font-size: 14px;">Critical issues requiring attention</p>
                </div>
            </div>
            
            <div class="admin-card">
                <div class="admin-card-header">
                    <span class="admin-card-icon">
                        <span class="material-icons-round" style="color: #7C3AED;">auto_fix_high</span>
                    </span>
                    <h3 class="admin-card-title">Active Corrections</h3>
                </div>
                <div style="text-align: center; padding: 20px 0;">
                    <div style="font-size: 48px; font-weight: 900; color: #7C3AED; line-height: 1;">{{ stats.active_corrections or 0 }}</div>
                    <p style="color: #6B7280; margin: 8px 0 0 0; font-size: 14px;">Intelligent data corrections active</p>
                </div>
            </div>
            
            <div class="admin-card">
                <div class="admin-card-header">
                    <span class="admin-card-icon">
                        <span class="material-icons-round" style="color: #059669;">precision_manufacturing</span>
                    </span>
                    <h3 class="admin-card-title">Pump Coverage</h3>
                </div>
                <div style="text-align: center; padding: 20px 0;">
                    <div style="font-size: 48px; font-weight: 900; color: #059669; line-height: 1;">386</div>
                    <p style="color: #6B7280; margin: 8px 0 0 0; font-size: 14px;">Models under AI management</p>
                </div>
            </div>
        </div>

        <!-- Features Grid -->
        <div class="features-grid">
            <!-- Data Quality Management -->
            <div class="feature-card">
                <div class="feature-header">
                    <span class="feature-icon">
                        <span class="material-icons-round">trending_up</span>
                    </span>
                    <h2 class="feature-title">Data Quality Management</h2>
                </div>
                <p class="feature-description">
                    Monitor and resolve data quality issues across all pump specifications. 
                    Automated detection of inconsistencies, outliers, and missing critical data points.
                </p>
                <div class="feature-actions">
                    <a href="/admin/brain/data-quality" class="btn btn-primary">
                        <span class="material-icons-round">visibility</span>
                        <span>View Issues</span>
                    </a>
                    <a href="/api/brain/quality-check/8K" class="btn btn-secondary">
                        <span class="material-icons-round">play_arrow</span>
                        <span>Run Scan</span>
                    </a>
                </div>
            </div>

            <!-- Data Corrections System -->
            <div class="feature-card">
                <div class="feature-header">
                    <span class="feature-icon">
                        <span class="material-icons-round">build</span>
                    </span>
                    <h2 class="feature-title">Corrections Management</h2>
                </div>
                <p class="feature-description">
                    Enterprise-grade correction system with approval workflows. 
                    All changes are auditable, reversible, and never modify the golden source database.
                </p>
                <div class="feature-actions">
                    <a href="/admin/brain/corrections" class="btn btn-primary">
                        <span class="material-icons-round">manage_accounts</span>
                        <span>Manage Corrections</span>
                    </a>
                    <a href="#" onclick="proposeCorrection()" class="btn btn-secondary">
                        <span class="material-icons-round">add</span>
                        <span>Propose New</span>
                    </a>
                </div>
            </div>

            <!-- Brain Logic Workbench -->
            <div class="feature-card">
                <div class="feature-header">
                    <span class="feature-icon">
                        <span class="material-icons-round">science</span>
                    </span>
                    <h2 class="feature-title">Logic Workbench</h2>
                </div>
                <p class="feature-description">
                    Test and validate configuration changes in a safe environment. 
                    Simulate scenarios and analyze impact before deploying to production.
                </p>
                <div class="feature-actions">
                    <a href="/admin/brain/workbench" class="btn btn-primary">
                        <span class="material-icons-round">launch</span>
                        <span>Open Workbench</span>
                    </a>
                    <a href="#" onclick="testScenario()" class="btn btn-secondary">
                        <span class="material-icons-round">psychology</span>
                        <span>Run Test</span>
                    </a>
                </div>
            </div>

            <!-- Configuration Management -->
            <div class="feature-card">
                <div class="feature-header">
                    <span class="feature-icon">
                        <span class="material-icons-round">tune</span>
                    </span>
                    <h2 class="feature-title">Configuration Profiles</h2>
                </div>
                <p class="feature-description">
                    Create and manage configuration profiles for different use cases. 
                    Fine-tune scoring weights and selection parameters.
                </p>
                <div class="feature-actions">
                    <a href="/admin/config/" class="btn btn-primary">
                        <span class="material-icons-round">view_list</span>
                        <span>View Profiles</span>
                    </a>
                    <a href="#" onclick="createProfile()" class="btn btn-secondary">
                        <span class="material-icons-round">add_circle</span>
                        <span>Create Profile</span>
                    </a>
                </div>
            </div>

            <!-- Manufacturer Comparison -->
            <div class="feature-card">
                <div class="feature-header">
                    <span class="feature-icon">
                        <span class="material-icons-round">compare</span>
                    </span>
                    <h2 class="feature-title">Manufacturer Comparison</h2>
                </div>
                <p class="feature-description">
                    Compare Brain predictions against manufacturer data. 
                    Analyze multi-point calibration with AI insights and visual overlays.
                </p>
                <div class="feature-actions">
                    <a href="{{ url_for('brain_admin.brain_workbench') }}" class="btn btn-primary">
                        <span class="material-icons-round">science</span>
                        <span>Open Workbench</span>
                    </a>
                    <a href="#" onclick="showPumpSelector()" class="btn btn-secondary">
                        <span class="material-icons-round">tune</span>
                        <span>Calibrate Pump</span>
                    </a>
                    <a href="#" onclick="uploadDatasheet()" class="btn btn-secondary">
                        <span class="material-icons-round">upload_file</span>
                        <span>Upload Datasheet</span>
                    </a>
                </div>
            </div>

            <!-- Decision Analytics -->
            <div class="feature-card">
                <div class="feature-header">
                    <span class="feature-icon">
                        <span class="material-icons-round">insights</span>
                    </span>
                    <h2 class="feature-title">Performance Analytics</h2>
                </div>
                <p class="feature-description">
                    Analyze decision patterns and track accuracy improvements over time. 
                    Generate comprehensive reports on system performance.
                </p>
                <div class="feature-actions">
                    <a href="/brain/metrics" class="btn btn-primary">
                        <span class="material-icons-round">dashboard</span>
                        <span>View Analytics</span>
                    </a>
                    <a href="#" onclick="generateReport()" class="btn btn-secondary">
                        <span class="material-icons-round">description</span>
                        <span>Generate Report</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- Scoring Algorithm Overview Section -->
        <div class="brain-section scoring-overview">
            <div class="section-header">
                <h3 class="section-title">Scoring & Selection Algorithms</h3>
                <p class="section-subtitle">100-Point Intelligence System</p>
            </div>
            
            <div class="scoring-grid">
                <!-- BEP Proximity Algorithm -->
                <div class="algorithm-card bep-algorithm">
                    <div class="card-icon">🎯</div>
                    <h4>BEP Proximity Scoring</h4>
                    <div class="points-badge">45 Points Max</div>
                    <div class="algorithm-details">
                        <div class="formula">
                            <code>Score = 45 × tiered(Flow_Ratio)</code>
                        </div>
                        <div class="algorithm-ranges">
                            <div class="range-item">
                                <span class="range-label">95-105% BEP:</span>
                                <span class="range-score">45 pts</span>
                            </div>
                            <div class="range-item">
                                <span class="range-label">90-95% | 105-110%:</span>
                                <span class="range-score">40 pts</span>
                            </div>
                            <div class="range-item">
                                <span class="range-label">80-90% | 110-120%:</span>
                                <span class="range-score">30 pts</span>
                            </div>
                            <div class="range-item">
                                <span class="range-label">70-80% | 120-130%:</span>
                                <span class="range-score">20 pts</span>
                            </div>
                            <div class="range-item">
                                <span class="range-label">60-70% | 130-140%:</span>
                                <span class="range-score">10 pts</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Efficiency Algorithm -->
                <div class="algorithm-card efficiency-algorithm">
                    <div class="card-icon">⚡</div>
                    <h4>Efficiency Scoring</h4>
                    <div class="points-badge">35 Points Max</div>
                    <div class="algorithm-details">
                        <div class="formula">
                            <code>Tiered efficiency scoring system</code>
                        </div>
                        <div class="algorithm-ranges">
                            <div class="range-item">
                                <span class="range-label">≥85% Efficiency:</span>
                                <span class="range-score">35 pts</span>
                            </div>
                            <div class="range-item">
                                <span class="range-label">75-85%:</span>
                                <span class="range-score">30+ pts</span>
                            </div>
                            <div class="range-item">
                                <span class="range-label">65-75%:</span>
                                <span class="range-score">25+ pts</span>
                            </div>
                            <div class="range-item">
                                <span class="range-label">45-65%:</span>
                                <span class="range-score">10+ pts</span>
                            </div>
                            <div class="range-item">
                                <span class="range-label">&lt;40%:</span>
                                <span class="range-score color-error">Disqualified</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Head Margin Algorithm -->
                <div class="algorithm-card margin-algorithm">
                    <div class="card-icon">📏</div>
                    <h4>Head Margin Scoring</h4>
                    <div class="points-badge">20 Points Max</div>
                    <div class="algorithm-details">
                        <div class="formula">
                            <code>Piecewise function based on head margin %</code>
                        </div>
                        <div class="algorithm-ranges">
                            <div class="range-item">
                                <span class="range-label">≤5% Margin:</span>
                                <span class="range-score">20 pts (Perfect)</span>
                            </div>
                            <div class="range-item">
                                <span class="range-label">5-10% Margin:</span>
                                <span class="range-score">10-20 pts</span>
                            </div>
                            <div class="range-item">
                                <span class="range-label">10-15% Margin:</span>
                                <span class="range-score">5-10 pts</span>
                            </div>
                            <div class="range-item">
                                <span class="range-label">15-20% Margin:</span>
                                <span class="range-score">0-5 pts</span>
                            </div>
                            <div class="range-item">
                                <span class="range-label">&lt;-2% Margin:</span>
                                <span class="range-score color-error">Disqualified</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- NPSH Algorithm -->
                <div class="algorithm-card npsh-algorithm">
                    <div class="card-icon">💧</div>
                    <h4>NPSH Validation</h4>
                    <div class="points-badge">Hard Gate</div>
                    <div class="algorithm-details">
                        <div class="formula">
                            <code>NPSHa ≥ NPSHr × 1.5 (Safety Factor)</code>
                        </div>
                        <div class="algorithm-ranges">
                            <div class="range-item">
                                <span class="range-label">NPSH Gate:</span>
                                <span class="range-score">Pass/Fail Only</span>
                            </div>
                            <div class="range-item">
                                <span class="range-label">Safety Factor:</span>
                                <span class="range-score">1.5× minimum</span>
                            </div>
                            <div class="range-item">
                                <span class="range-label">Missing NPSHa:</span>
                                <span class="range-score">No penalty applied</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Penalties Section -->
                <div class="algorithm-card penalties-algorithm">
                    <div class="card-icon">⚠️</div>
                    <h4>Modification Penalties</h4>
                    <div class="points-badge">Deductions</div>
                    <div class="algorithm-details">
                        <div class="algorithm-ranges">
                            <div class="range-item">
                                <span class="range-label">≥95% Trim:</span>
                                <span class="range-score">0 pts penalty</span>
                            </div>
                            <div class="range-item">
                                <span class="range-label">90-95% Trim:</span>
                                <span class="range-score">-2 pts</span>
                            </div>
                            <div class="range-item">
                                <span class="range-label">85-90% Trim:</span>
                                <span class="range-score">-5 pts</span>
                            </div>
                            <div class="range-item">
                                <span class="range-label">80-85% Trim:</span>
                                <span class="range-score">-8 pts</span>
                            </div>
                            <div class="range-item">
                                <span class="range-label">75-80% Trim:</span>
                                <span class="range-score">-12 pts</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- QBP Gates -->
                <div class="algorithm-card qbp-algorithm">
                    <div class="card-icon">🚪</div>
                    <h4>QBP Operating Gates</h4>
                    <div class="points-badge">Hard Gates</div>
                    <div class="algorithm-details">
                        <div class="algorithm-ranges">
                            <div class="range-item">
                                <span class="range-label">Minimum QBP:</span>
                                <span class="range-score">60% of BEP flow</span>
                            </div>
                            <div class="range-item">
                                <span class="range-label">Maximum QBP:</span>
                                <span class="range-score">130% of BEP flow</span>
                            </div>
                            <div class="range-item">
                                <span class="range-label">Outside Range:</span>
                                <span class="range-score color-error">Immediate Disqualification</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Selection Methodology Section -->
        <div class="brain-section methodology-overview">
            <div class="section-header">
                <h3 class="section-title">Selection Methodology</h3>
                <p class="section-subtitle">Fixed-Speed Priority with Intelligent Fallbacks</p>
            </div>
            
            <div class="methodology-flow">
                <div class="method-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h4>Physical Capability Gate</h4>
                        <p>Verify pump can deliver required flow and head within manufacturer's envelope</p>
                        <div class="step-criteria">
                            <span class="criteria-item">✓ Operating point within curves</span>
                            <span class="criteria-item">✓ Manufacturer data validation</span>
                        </div>
                    </div>
                </div>

                <div class="method-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h4>Standard Operation (No Modifications)</h4>
                        <p>Evaluate pump at design speed with full impeller diameter</p>
                        <div class="step-criteria">
                            <span class="criteria-item">✓ 100% impeller diameter</span>
                            <span class="criteria-item">✓ Standard RPM operation</span>
                            <span class="criteria-item">✓ Maximum scoring potential</span>
                        </div>
                    </div>
                </div>

                <div class="method-step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h4>Impeller Trimming (If Required)</h4>
                        <p>Apply affinity laws for diameter reduction when needed</p>
                        <div class="step-criteria">
                            <span class="criteria-item">✓ 85-100% diameter range</span>
                            <span class="criteria-item">✓ Trim penalties applied</span>
                            <span class="criteria-item">✓ NPSH safety validation</span>
                        </div>
                    </div>
                </div>

                <div class="method-step">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <h4>Safety Gates Validation</h4>
                        <p>Hard gates for operational safety and reliability</p>
                        <div class="step-criteria">
                            <span class="criteria-item">✓ QBP: 60-130% of BEP flow</span>
                            <span class="criteria-item">✓ NPSH: 1.5× safety factor</span>
                            <span class="criteria-item">✓ Head margin: >-2%</span>
                        </div>
                    </div>
                </div>

                <div class="method-step">
                    <div class="step-number">5</div>
                    <div class="step-content">
                        <h4>Intelligent Scoring & Ranking</h4>
                        <p>100-point system prioritizing reliability and efficiency</p>
                        <div class="step-criteria">
                            <span class="criteria-item">✓ BEP proximity (45 pts max)</span>
                            <span class="criteria-item">✓ Efficiency (35 pts max)</span>
                            <span class="criteria-item">✓ Head margin (20 pts max)</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function proposeCorrection() {
    const pumpCode = prompt('Enter pump code:');
    if (pumpCode) {
        window.location.href = `/admin/brain/corrections?pump=${pumpCode}`;
    }
}

function testScenario() {
    const flow = prompt('Enter flow rate (m³/hr):');
    const head = prompt('Enter head (m):');
    if (flow && head) {
        window.location.href = `/admin/brain/workbench?flow=${flow}&head=${head}`;
    }
}

function createProfile() {
    window.location.href = '/admin/config?action=create';
}

function generateReport() {
    alert('Report generation feature coming soon');
}

function uploadDatasheet() {
    // Create a modal for datasheet upload
    const modalHtml = `
        <div id="datasheet-upload-modal" class="modal">
            <div class="modal-content">
                <h4>Upload Manufacturer Datasheet</h4>
                <p>Upload a PDF or image file containing pump performance data:</p>
                <div class="file-field input-field">
                    <div class="btn">
                        <span>Choose File</span>
                        <input type="file" id="datasheet-file" accept=".pdf,.png,.jpg,.jpeg">
                    </div>
                    <div class="file-path-wrapper">
                        <input class="file-path validate" type="text" placeholder="Select a datasheet file">
                    </div>
                </div>
                <div class="row">
                    <div class="col s12">
                        <p class="grey-text">Supported formats: PDF, PNG, JPG, JPEG</p>
                        <p class="grey-text">Maximum file size: 10MB</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <a href="#!" class="modal-close waves-effect waves-red btn-flat">Cancel</a>
                <a href="#!" onclick="processDatasheetUpload()" class="waves-effect waves-green btn-flat">Upload & Process</a>
            </div>
        </div>
    `;
    
    // Add modal to page if not exists
    if (!document.getElementById('datasheet-upload-modal')) {
        document.body.insertAdjacentHTML('beforeend', modalHtml);
    }
    
    // Initialize and open modal
    const modal = document.getElementById('datasheet-upload-modal');
    const instance = M.Modal.init(modal);
    instance.open();
}

function processDatasheetUpload() {
    const fileInput = document.getElementById('datasheet-file');
    const file = fileInput ? fileInput.files[0] : null;
    
    if (!file) {
        M.toast({html: 'Please select a file to upload', classes: 'red'});
        return;
    }
    
    if (file.size > 10 * 1024 * 1024) {
        M.toast({html: 'File size exceeds 10MB limit', classes: 'red'});
        return;
    }
    
    // For now, show a success message - actual processing would be implemented here
    M.toast({html: 'Datasheet uploaded successfully! Processing...', classes: 'green'});
    
    // Close the modal
    const modal = document.getElementById('datasheet-upload-modal');
    const instance = M.Modal.getInstance(modal);
    if (instance) {
        instance.close();
    }
    
    // In production, this would upload the file and process it
    console.log('Processing datasheet:', file.name, 'Size:', file.size, 'Type:', file.type);
}

function showPumpSelector() {
    // Create a modal for pump selection
    const modalHtml = `
        <div id="pump-selector-modal" class="modal">
            <div class="modal-content">
                <h4>Select Pump for Calibration</h4>
                <p>Enter the pump code to open its calibration workbench:</p>
                <div class="input-field">
                    <input type="text" id="pump-code-input" placeholder="e.g., 4503-44648">
                    <label for="pump-code-input">Pump Code</label>
                </div>
                <div class="row">
                    <div class="col s12">
                        <p class="grey-text">Or select from recent pumps:</p>
                        <div class="collection">
                            <a href="/admin/pump-calibration/4503-44648" class="collection-item">4503-44648 - 6x8x10 WL</a>
                            <a href="/admin/pump-calibration/4502-42848" class="collection-item">4502-42848 - 6x8x10 WLN</a>
                            <a href="/admin/pump-calibration/2502-55" class="collection-item">2502-55 - 10 WLN 32A</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <a href="#!" class="modal-close waves-effect waves-red btn-flat">Cancel</a>
                <a href="#!" onclick="navigateToCalibration()" class="waves-effect waves-green btn-flat">Open Calibration</a>
            </div>
        </div>
    `;
    
    // Add modal to page if not exists
    if (!document.getElementById('pump-selector-modal')) {
        document.body.insertAdjacentHTML('beforeend', modalHtml);
    }
    
    // Initialize and open modal
    const modal = document.getElementById('pump-selector-modal');
    const instance = M.Modal.init(modal);
    instance.open();
    
    // Focus on input
    setTimeout(() => {
        document.getElementById('pump-code-input').focus();
    }, 100);
}

function navigateToCalibration() {
    const pumpCode = document.getElementById('pump-code-input').value.trim();
    if (pumpCode) {
        window.location.href = `/admin/pump-calibration/${pumpCode}`;
    } else {
        M.toast({html: 'Please enter a pump code', classes: 'red'});
    }
}

// Initialize algorithm cards with interactive functionality
document.addEventListener('DOMContentLoaded', function() {
    // Ensure navigation dropdowns are initialized (in case navigation.html script hasn't run)
    if (typeof initializeNavDropdowns === 'undefined') {
        // Re-initialize navigation dropdowns if function not available
        console.log('Re-initializing navigation dropdowns from brain dashboard...');
        const dropdownButtons = document.querySelectorAll('.nav-dropdown > button');
        
        dropdownButtons.forEach(button => {
            button.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                const dropdownContent = this.parentElement.querySelector('.nav-dropdown-content');
                if (!dropdownContent) return;
                
                const isOpen = dropdownContent.classList.contains('show');
                
                // Close all dropdowns first
                document.querySelectorAll('.nav-dropdown-content').forEach(dropdown => {
                    dropdown.classList.remove('show');
                });
                
                // Toggle this dropdown
                if (!isOpen) {
                    dropdownContent.classList.add('show');
                }
            });
        });
        
        // Close dropdowns when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.nav-dropdown')) {
                document.querySelectorAll('.nav-dropdown-content').forEach(dropdown => {
                    dropdown.classList.remove('show');
                });
            }
        });
    }
    
    // Initialize Materialize components specifically for modals
    const modals = document.querySelectorAll('.modal');
    if (typeof M !== 'undefined' && M.Modal) {
        M.Modal.init(modals);
    }
    
    // Initialize algorithm cards
    const algorithmCards = document.querySelectorAll('.algorithm-card');
    
    algorithmCards.forEach(card => {
        card.addEventListener('click', function() {
            this.classList.toggle('expanded');
        });
    });
});
</script>
{% endblock %}