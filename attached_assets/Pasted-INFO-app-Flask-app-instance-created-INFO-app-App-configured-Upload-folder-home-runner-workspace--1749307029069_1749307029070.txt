INFO:app:Flask app instance created.
INFO:app:App configured. Upload folder: /home/runner/workspace/app/static/temp
INFO:app:Routes imported.
INFO:app.llm_reasoning:OpenAI client initialized successfully
INFO:app.llm_reasoning:Google Gemini client initialized successfully
INFO:app.llm_reasoning:LLM reasoning module initialized successfully
 * Serving Flask app 'app'
 * Debug mode: on
INFO:werkzeug:WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:8080
 * Running on http://172.31.128.77:8080
INFO:werkzeug:Press CTRL+C to quit
INFO:werkzeug: * Restarting with stat
INFO:app:Flask app instance created.
INFO:app:App configured. Upload folder: /home/runner/workspace/app/static/temp
INFO:app:Routes imported.
INFO:app.llm_reasoning:OpenAI client initialized successfully
INFO:app.llm_reasoning:Google Gemini client initialized successfully
INFO:app.llm_reasoning:LLM reasoning module initialized successfully
WARNING:werkzeug: * Debugger is active!
INFO:werkzeug: * Debugger PIN: 125-108-284
INFO:app.routes:Index route accessed.
INFO:werkzeug:172.31.128.77 - - [07/Jun/2025 14:36:42] "GET / HTTP/1.1" 200 -
INFO:werkzeug:172.31.128.77 - - [07/Jun/2025 14:36:42] "GET /static/images/ape_logo.svg HTTP/1.1" 304 -
INFO:werkzeug:172.31.128.77 - - [07/Jun/2025 14:36:42] "GET /static/css/style.css HTTP/1.1" 304 -
INFO:werkzeug:172.31.128.77 - - [07/Jun/2025 14:36:42] "GET /static/js/main.js HTTP/1.1" 304 -
INFO:app.routes:Processing requirements: SiteRequirements(flow=342.0 mÂ³/hr, head=27.4 m)
INFO:pump_engine:Loaded 3 pumps from database
INFO:app.routes:Successfully parsed 3 pumps
WARNING:pump_engine:Extrapolating value for x=342.0 (original range: 10.0-309.0, with 20% margin: -49.8-368.8)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 11.0 (extrapolated: True)
WARNING:pump_engine:Extrapolating value for x=342.0 (original range: 10.0-309.0, with 20% margin: -49.8-368.8)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 60.0 (extrapolated: True)
WARNING:pump_engine:Extrapolating value for x=342.0 (original range: 10.0-309.0, with 20% margin: -49.8-368.8)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 55.57365 (extrapolated: True)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 33.275 (extrapolated: False)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 74.75 (extrapolated: False)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 147.4810875 (extrapolated: False)
INFO:pump_engine:About to calculate suitability score for pump 6 K 6 VANE
INFO:pump_engine:Operating point data: {'curve_index': 1, 'impeller_size': '394.00', 'flow_m3hr': 342.0, 'achieved_head_m': 33.275, 'achieved_efficiency_pct': 74.75, 'achieved_power_kw': 147.4810875, 'achieved_npshr_m': None, 'head_was_extrapolated': False, 'efficiency_was_extrapolated': False, 'power_was_extrapolated': False, 'npshr_was_extrapolated': False, 'operating_point_overall_extrapolated': False, 'curve_range_min': 10.0, 'curve_range_max': 414.0, 'extrapolated': False}
WARNING:pump_engine:Extrapolating value for x=342.0 (original range: 10.0-309.0, with 20% margin: -49.8-368.8)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 11.0 (extrapolated: True)
WARNING:pump_engine:Extrapolating value for x=342.0 (original range: 10.0-309.0, with 20% margin: -49.8-368.8)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 60.0 (extrapolated: True)
WARNING:pump_engine:Extrapolating value for x=342.0 (original range: 10.0-309.0, with 20% margin: -49.8-368.8)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 55.57365 (extrapolated: True)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 33.275 (extrapolated: False)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 74.75 (extrapolated: False)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 147.4810875 (extrapolated: False)
INFO:pump_engine:Suitability score calculated successfully: {'overall_score': 77.03503649635037, 'head_accuracy_score': 78.55839416058394, 'efficiency_score': 74.75, 'operating_point': {'curve_index': 1, 'impeller_size': '394.00', 'flow_m3hr': 342.0, 'achieved_head_m': 33.275, 'achieved_efficiency_pct': 74.75, 'achieved_power_kw': 147.4810875, 'achieved_npshr_m': None, 'head_was_extrapolated': False, 'efficiency_was_extrapolated': False, 'power_was_extrapolated': False, 'npshr_was_extrapolated': False, 'operating_point_overall_extrapolated': False, 'curve_range_min': 10.0, 'curve_range_max': 414.0, 'extrapolated': False}, 'best_curve_index': 1}
INFO:pump_engine:Pump 6 K 6 VANE evaluation completed with score: 77.03503649635037
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 15.542622950819672 (extrapolated: False)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 77.08196721311475 (extrapolated: False)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 67.6242477954273 (extrapolated: False)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 3.6495081967213117 (extrapolated: False)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 23.418181818181818 (extrapolated: False)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 81.15454545454546 (extrapolated: False)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 96.29131366039137 (extrapolated: False)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 3.3036363636363637 (extrapolated: False)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 27.4 (extrapolated: False)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 82.0 (extrapolated: False)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 112.10676585365853 (extrapolated: False)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 2.78 (extrapolated: False)
INFO:pump_engine:About to calculate suitability score for pump 6/8 ALE
INFO:pump_engine:Operating point data: {'curve_index': 2, 'impeller_size': '312.00', 'flow_m3hr': 342.0, 'achieved_head_m': 27.4, 'achieved_efficiency_pct': 82.0, 'achieved_power_kw': 112.10676585365853, 'achieved_npshr_m': 2.78, 'head_was_extrapolated': False, 'efficiency_was_extrapolated': False, 'power_was_extrapolated': False, 'npshr_was_extrapolated': False, 'operating_point_overall_extrapolated': False, 'curve_range_min': 0.0, 'curve_range_max': 408.0, 'extrapolated': False}
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 15.542622950819672 (extrapolated: False)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 77.08196721311475 (extrapolated: False)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 67.6242477954273 (extrapolated: False)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 3.6495081967213117 (extrapolated: False)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 23.418181818181818 (extrapolated: False)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 81.15454545454546 (extrapolated: False)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 96.29131366039137 (extrapolated: False)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 3.3036363636363637 (extrapolated: False)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 27.4 (extrapolated: False)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 82.0 (extrapolated: False)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 112.10676585365853 (extrapolated: False)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 2.78 (extrapolated: False)
INFO:pump_engine:Suitability score calculated successfully: {'overall_score': 92.80000000000001, 'head_accuracy_score': 100.0, 'efficiency_score': 82.0, 'operating_point': {'curve_index': 2, 'impeller_size': '312.00', 'flow_m3hr': 342.0, 'achieved_head_m': 27.4, 'achieved_efficiency_pct': 82.0, 'achieved_power_kw': 112.10676585365853, 'achieved_npshr_m': 2.78, 'head_was_extrapolated': False, 'efficiency_was_extrapolated': False, 'power_was_extrapolated': False, 'npshr_was_extrapolated': False, 'operating_point_overall_extrapolated': False, 'curve_range_min': 0.0, 'curve_range_max': 408.0, 'extrapolated': False}, 'best_curve_index': 2}
INFO:pump_engine:Pump 6/8 ALE evaluation completed with score: 92.80000000000001
WARNING:pump_engine:Extrapolating value for x=342.0 (original range: 0.0-300.0, with 20% margin: -60.0-360.0)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 22.9 (extrapolated: True)
WARNING:pump_engine:Extrapolating value for x=342.0 (original range: 0.0-300.0, with 20% margin: -60.0-360.0)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 59.0 (extrapolated: True)
WARNING:pump_engine:Extrapolating value for x=342.0 (original range: 0.0-300.0, with 20% margin: -60.0-360.0)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 114.22830508474576 (extrapolated: True)
INFO:pump_engine:About to calculate suitability score for pump 5 K
INFO:pump_engine:Operating point data: {'curve_index': 1, 'impeller_size': '356.00', 'flow_m3hr': 342.0, 'achieved_head_m': 22.9, 'achieved_efficiency_pct': 59.0, 'achieved_power_kw': 114.22830508474576, 'achieved_npshr_m': None, 'head_was_extrapolated': True, 'efficiency_was_extrapolated': True, 'power_was_extrapolated': True, 'npshr_was_extrapolated': False, 'operating_point_overall_extrapolated': True, 'curve_range_min': 0.0, 'curve_range_max': 300.0, 'extrapolated': True}
WARNING:pump_engine:Extrapolating value for x=342.0 (original range: 0.0-300.0, with 20% margin: -60.0-360.0)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 22.9 (extrapolated: True)
WARNING:pump_engine:Extrapolating value for x=342.0 (original range: 0.0-300.0, with 20% margin: -60.0-360.0)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 59.0 (extrapolated: True)
WARNING:pump_engine:Extrapolating value for x=342.0 (original range: 0.0-300.0, with 20% margin: -60.0-360.0)
INFO:pump_engine:Interpolation SUCCESS for x=342.0: 114.22830508474576 (extrapolated: True)
INFO:pump_engine:Suitability score calculated successfully: {'overall_score': 73.74598540145985, 'head_accuracy_score': 83.57664233576642, 'efficiency_score': 59.0, 'operating_point': {'curve_index': 1, 'impeller_size': '356.00', 'flow_m3hr': 342.0, 'achieved_head_m': 22.9, 'achieved_efficiency_pct': 59.0, 'achieved_power_kw': 114.22830508474576, 'achieved_npshr_m': None, 'head_was_extrapolated': True, 'efficiency_was_extrapolated': True, 'power_was_extrapolated': True, 'npshr_was_extrapolated': False, 'operating_point_overall_extrapolated': True, 'curve_range_min': 0.0, 'curve_range_max': 300.0, 'extrapolated': True}, 'best_curve_index': 1}
INFO:pump_engine:Pump 5 K evaluation completed with score: 73.74598540145985
INFO:app.routes:Generating charts for pump: 6/8 ALE
INFO:app.routes:Operating point data: {'curve_index': 2, 'impeller_size': '312.00', 'flow_m3hr': 342.0, 'achieved_head_m': 27.4, 'achieved_efficiency_pct': 82.0, 'achieved_power_kw': 112.10676585365853, 'achieved_npshr_m': 2.78, 'head_was_extrapolated': False, 'efficiency_was_extrapolated': False, 'power_was_extrapolated': False, 'npshr_was_extrapolated': False, 'operating_point_overall_extrapolated': False, 'curve_range_min': 0.0, 'curve_range_max': 408.0, 'extrapolated': False}
INFO:werkzeug:172.31.128.77 - - [07/Jun/2025 14:36:49] "GET /pump-options?flow=342&head=27.4&contact_name=James+Richardson&company=Municipal+Water+Authority&email=j.richardson@waterauth.gov.uk&project_name=Town+Centre+Water+Supply+Upgrade&application=water&project_location=Central+Pumping+Station,+Manchester&liquid_type=water&temperature=15&specific_gravity=1.0&viscosity=1.0&suction_pressure=0.1&static_head=15&npsh_available=4.5&max_power=30 HTTP/1.1" 302 -
INFO:app.routes:Displaying report for pump: 6/8 ALE
INFO:app.routes:Template data - selected_pump operating_point: {'achieved_efficiency_pct': 82.0, 'achieved_head_m': 27.4, 'achieved_npshr_m': 2.78, 'achieved_power_kw': 112.10676585365853, 'curve_index': 2, 'curve_range_max': 408.0, 'curve_range_min': 0.0, 'efficiency_was_extrapolated': False, 'extrapolated': False, 'flow_m3hr': 342.0, 'head_was_extrapolated': False, 'impeller_size': '312.00', 'npshr_was_extrapolated': False, 'operating_point_overall_extrapolated': False, 'power_was_extrapolated': False}
INFO:app.routes:Template data - selected_pump selected_curve: {'impeller_size': '312.00', 'is_selected': True, 'curve_index': 2}
ERROR:app.routes:Error displaying pump report: Encountered unknown tag 'endblock'.
Traceback (most recent call last):
  File "/home/runner/workspace/app/routes.py", line 377, in pump_report
    return render_template('professional_pump_report.html', **context_data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/flask/templating.py", line 149, in render_template
    template = app.jinja_env.get_or_select_template(template_name_or_list)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/jinja2/environment.py", line 1087, in get_or_select_template
    return self.get_template(template_name_or_list, parent, globals)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/jinja2/environment.py", line 1016, in get_template
    return self._load_template(name, globals)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/jinja2/environment.py", line 975, in _load_template
    template = self.loader.load(self, name, self.make_globals(globals))
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/jinja2/loaders.py", line 138, in load
    code = environment.compile(source, name, filename)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/jinja2/environment.py", line 771, in compile
    self.handle_exception(source=source_hint)
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/home/runner/workspace/templates/professional_pump_report.html", line 701, in template
    {% endblock %}
jinja2.exceptions.TemplateSyntaxError: Encountered unknown tag 'endblock'.
INFO:werkzeug:172.31.128.77 - - [07/Jun/2025 14:36:49] "GET /pump_report/6/8%20ALE HTTP/1.1" 302 -
INFO:app.routes:Index route accessed.
INFO:werkzeug:172.31.128.77 - - [07/Jun/2025 14:36:49] "GET / HTTP/1.1" 200 -
INFO:werkzeug:172.31.128.77 - - [07/Jun/2025 14:36:50] "GET /static/images/ape_logo.svg HTTP/1.1" 304 -
INFO:werkzeug:172.31.128.77 - - [07/Jun/2025 14:36:50] "GET /static/css/style.css HTTP/1.1" 304 -
INFO:werkzeug:172.31.128.77 - - [07/Jun/2025 14:36:50] "GET /static/js/main.js HTTP/1.1" 304 -