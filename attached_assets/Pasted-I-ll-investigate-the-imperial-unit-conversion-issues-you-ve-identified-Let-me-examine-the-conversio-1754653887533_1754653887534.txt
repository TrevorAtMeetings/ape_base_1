I'll investigate the imperial unit conversion issues you've identified. Let me examine the conversion logic in the frontend code.


Opened static/js/main.js
Let me search for the unit conversion logic:


Searched for "Find the imperial unit conversion code for flow (GPM) and head (feet) calculations. Looking for conversion functions that convert between metric and imperial units in the frontend JavaScript."
Let me search more broadly for unit conversion logic:


Searched for ""
Let me check the input form template for the unit conversion logic:


Opened templates/input_form.html
Now let me check the storage values logic:


Opened templates/input_form.html
Investigation Results: Imperial Unit Conversion Issues
I've found two critical problems in your imperial conversion logic:

‚ùå PROBLEM 1: Head Conversion Factor Error
Current code (lines 1114-1115):

// Convert meters to feet: 1 m = 3.28084 ft
const convertedValue = (headValue * 3.28084);
Issue: You're multiplying instead of dividing!

When switching TO imperial: Should convert 25m ‚Üí feet (25 √ó 3.28084 = 82.02 ft) ‚úì
When switching TO metric: Should convert feet ‚Üí meters (164 √∑ 3.28084 = 49.99m) ‚ùå
The problem: Line 1127-1128 converts feet to meters incorrectly:

// Convert feet to meters: 1 ft = 0.3048 m
const convertedValue = (headValue * 0.3048);
This is correct! So the issue is elsewhere...

‚ùå PROBLEM 2: Wrong Conversion Direction Logic
Looking at your console logs, I see the issue:

User enters 164 in imperial mode (should be 164 feet)
But the system thinks it's converting FROM feet TO meters
So 164 ft √ó 0.3048 = 49.99m instead of treating 164 as already being in feet
The core issue: The conversion logic in switchUnitSystem() assumes the input value is in the OLD unit system, but when users type directly in imperial mode, they're already entering imperial values.

‚ùå PROBLEM 3: GPM Conversion Factor
Current code (line 1081):

// Convert m¬≥/hr to GPM: m¬≥/hr √∑ 0.227124 
const convertedValue = (flowValue / 0.227124);
The issue: This conversion factor might be slightly off.

Correct factor: 1 m¬≥/hr = 4.40287 GPM
Your factor: 1/0.227124 = 4.403 GPM ‚úì (This is actually correct)
But the real issue: Same logic problem as head - when users type in imperial mode, they're entering GPM values, not m¬≥/hr values to convert.

üîç ROOT CAUSE
The switchUnitSystem() function was designed for unit system switching (convert existing values), but it's also being triggered when users are entering values directly in imperial mode. The system incorrectly assumes imperial inputs need conversion when they don't.

üí° RECOMMENDED FIXES
Separate conversion logic for unit switching vs. direct imperial input
Check the source of the conversion trigger (unit switch vs. direct input)
Fix head conversion direction in the feet‚Üímeters path
Add validation to prevent double conversion
Would you like me to implement these fixes, or do you want to review the logic further first?