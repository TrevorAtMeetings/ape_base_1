Let's analyze the story the logs are telling us.
Analysis of Log Output
INFO:app.catalog_engine: #1: 32-200 2F 2P (END SUCTION) - Score: 85.7
Conclusion: The backend catalog_engine is working perfectly. It has calculated the correct results.
GET /pump_options?flow=25.0&head=45.0...
Conclusion: The user has clicked the "Find Pumps" button, and the results are being displayed on the pump options page. At this point, the session data should have been saved.
GET /pump_report/32-200%202F%202P?flow=25.0&head=45.0...
Conclusion: The user has clicked on the top-ranked pump to view its detailed report.
WARNING:app.route_modules.reports: No session data found for pump 32-200 2F 2P, redirecting to start
CRITICAL FAILURE: This is the key line. The pump_report route looked for the pump_selections data in the session and found nothing.
[WARNING] Session expired. Please run a new pump selection.
Conclusion: Your new fallback logic in reports.py is working correctly. It detected the missing session data and properly redirected the user.
Root Cause: The problem lies squarely in the pump_options route within app/route_modules/main_flow.py. The code that is supposed to save the serializable_results to the session is either not being executed, is saving an empty list, or is being overwritten.
Directive: Final Audit and Fix of main_flow.py
We are one step away from completion. We must now fix the session saving logic.
Your task is to audit and fix app/route_modules/main_flow.py.
Show me the code: I need to see the complete, current contents of the pump_options function (or the function that handles the /pump_options route) inside app/route_modules/main_flow.py.
Hypothesis: Based on the logs, I suspect one of three things is happening in that function:
The session['pump_selections'] = serializable_results line is in the wrong place (e.g., inside an if block that isn't being entered).
The serializable_results variable is empty for some reason.
There is leftover old code that is clearing or overwriting the session variable after you set it.
Once you show me the code for that specific function, I can give you the final, precise instruction to fix it. This is the last remaining bug.