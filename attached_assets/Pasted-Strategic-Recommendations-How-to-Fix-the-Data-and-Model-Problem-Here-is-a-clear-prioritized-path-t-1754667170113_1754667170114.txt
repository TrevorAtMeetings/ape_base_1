Strategic Recommendations: How to Fix the Data and Model Problem
Here is a clear, prioritized path to not only fix this specific issue but also make your entire system more accurate and robust.
Recommendation 1: Improve the Interpolation Model (Highest Priority)
The root cause of the discrepancy is using linear interpolation on a fundamentally parabolic (curved) phenomenon.
Insight: A straight line drawn between two points on an arc will always sit below the arc. This is why your calculated 48.75m is lower than the likely true peak of 50.01m.
Action: Change the interpolation method in app/catalog_engine.py from 'linear' to a method that can model a curve. 'quadratic' (for a parabola) or 'cubic' are excellent choices.
Implementation (app/catalog_engine.py):
code
Python
# In _get_performance_interpolated() and other calculation methods

# This change should be applied wherever you use interpolate.interp1d

# Ensure you have enough points for the chosen method
if len(flows) >= 4:
    interpolation_kind = 'cubic'  # Very smooth, good for dense data
elif len(flows) == 3:
    interpolation_kind = 'quadratic' # Perfect for modeling a parabola
else: # Fallback for 2 points
    interpolation_kind = 'linear' 

head_interp = interpolate.interp1d(flows, heads, kind=interpolation_kind, bounds_error=False, fill_value='extrapolate')
eff_interp = interpolate.interp1d(flows, effs, kind=interpolation_kind, bounds_error=False, fill_value='extrapolate')

predicted_head = float(head_interp(flow_m3hr))
Expected Outcome: With a quadratic or cubic interpolation, the calculated head at 366 mÂ³/hr will be significantly higher than 48.75m and will likely be very close to, or even match, the specified 50.01m. This will resolve the data conflict mathematically and allow the pump to be correctly selected at its true BEP.
Recommendation 2: Implement a Data Ingestion Sanity Check (Long-Term Quality)
You should prevent inconsistent data from entering your "golden source" in the first place.
Insight: This problem started when the pump data was first loaded. A validation step could have caught it.
Action: Create a validation script or a pre-save hook in your data management system. When new pump data is uploaded, this script should:
Take the new pump's curve data.
Use the improved (quadratic or cubic) interpolation to calculate the BEP (flow, head, efficiency) directly from the curve points.
Compare the calculated BEP to the specified BEP values.
If the discrepancy in head or efficiency is larger than a set tolerance (e.g., > 2%), flag the data for manual review and do not let it become active in the catalog until it is corrected.
Impact: This ensures the integrity of your "golden source" and prevents the selection engine from ever having to resolve these conflicts.
Recommendation 3: Enhance UI Transparency (Optional but Recommended)
Even with an improved model, small discrepancies might remain. You can build user trust by being transparent.
Action: If a small, acceptable discrepancy (<2%) exists between the calculated performance and the manufacturer's spec, you can display both in the report.
Example UI Text:
Operating Head: 49.9m
Efficiency at Duty: 78.0%
Note: Performance calculated from manufacturer's test curve. Stated BEP is 50.01m at 78.1% efficiency.
This shows the user that your system is intelligent, precise, and honest about its data sources.