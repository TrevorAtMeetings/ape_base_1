Agent, the detailed logging has been invaluable! We've pinpointed the exact cause of the error when rendering the professional_pump_report.html page.
The console log shows:
ERROR:app.routes:Error displaying pump report: 'selected_evaluation' is undefined
This occurs in templates/professional_pump_report.html at line 929:
efficiency: '{{ selected_evaluation.operating_point.efficiency|default("82") }}',
The issue is that the pump_report route in app/routes.py passes the data for the main selected pump to the template using the variable name selected_pump, but the template is trying to access it as selected_evaluation.
Please implement the following fix:
Standardize Variable Name in professional_pump_report.html:
File: templates/professional_pump_report.html
Action: Search and replace all instances of selected_evaluation with selected_pump.
For example, line 929 should become:
efficiency: '{{ selected_pump.operating_point.efficiency|default("82") }}',
Review the entire template for other occurrences of selected_evaluation and change them to selected_pump to match the context dictionary provided by the pump_report route. The selected_pump variable in the context is the dictionary containing all the evaluation details, including the operating_point dictionary.
After making this change:
Restart the application.
Test the full workflow again by submitting the form (e.g., with Flow=342, Head=27.4) which should redirect to the /pump_report/6/8%20ALE page.
Verify that professional_pump_report.html now renders completely without the UndefinedError: 'selected_evaluation' is undefined.
Crucially, verify that all data points on this detailed report page are now correct and accurate (Operating Point in text, Selected Pump Specifications table, Operating Point Analysis section, Technical Selection Reasoning including the Overall Suitability Score, Alternative Pump Options data, and the static Matplotlib charts with real data and marked operating points).
This fix should resolve the template rendering crash. Once this page displays correctly with all accurate data and charts, the PDF generation (which uses the same template or a very similar one) should also be much closer to working perfectly.
Let me know the outcome after you've applied this fix and tested."